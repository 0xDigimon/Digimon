<!doctype html>
<html lang="en-us">
  <head>
    <title>Common API Vulnerabilities // Abdelrhman Allam</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.101.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Abdelrhman Allam" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://sl4x0.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Common API Vulnerabilities"/>
<meta name="twitter:description" content="Understanding common vulnerabilities will help you identify weaknesses when you‚Äôre testing APIs.
Information Disclosure Information may be disclosed in API responses or public sources such as code repositories, search results, news, social media, the target‚Äôs website, and public API directories.
Sensitive data can include any information that attackers can leverage to their advantage.
For example, a site that is using the WordPress API may unknowingly be sharing user information with anyone who navigates to the API path /wp-json/wp/v2/users"/>

    <meta property="og:title" content="Common API Vulnerabilities" />
<meta property="og:description" content="Understanding common vulnerabilities will help you identify weaknesses when you‚Äôre testing APIs.
Information Disclosure Information may be disclosed in API responses or public sources such as code repositories, search results, news, social media, the target‚Äôs website, and public API directories.
Sensitive data can include any information that attackers can leverage to their advantage.
For example, a site that is using the WordPress API may unknowingly be sharing user information with anyone who navigates to the API path /wp-json/wp/v2/users" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sl4x0.github.io/api-notes/common-api-vulnerablities/" /><meta property="article:section" content="api-notes" />
<meta property="article:published_time" content="2022-10-20T15:48:05+00:00" />
<meta property="article:modified_time" content="2022-10-20T15:48:05+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://sl4x0.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Abdelrhman Allam" /></a>
      <h1>Abdelrhman Allam</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/about/">About</a>
             // 
          
          <a class="app-header-menu-item" href="/">Home</a>
             // 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Security Researcher üêõ</p>
      <div class="app-header-social">
        
          <a href="https://github.com/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://twitter.com/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>My Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
          <a href="https://linkedin.com/in/sl4x0" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>My Twitter</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Common API Vulnerabilities</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 20, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          14 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://sl4x0.github.io/tags/api-security/">api-security</a>
              <a class="tag" href="https://sl4x0.github.io/tags/api-notes/">api-notes</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p><img src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/103/2021/08/31092830/APIs-e1630416526184.gif" alt=""></p>
<p><em>Understanding common vulnerabilities will help you identify weaknesses when you‚Äôre
testing APIs.</em></p>
<h1 id="information-disclosure">Information Disclosure</h1>
<blockquote>
<p>Information may be disclosed in <strong>API responses</strong> or <strong>public sources</strong> such as code repositories, search results, news, social media, the target‚Äôs website, and public API directories.</p>
</blockquote>
<p>Sensitive data can include any information that attackers can leverage to their advantage.</p>
<p>For example, a site that is using the WordPress API may unknowingly be sharing user information with anyone who navigates to the API path <code>/wp-json/wp/v2/users</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET</span> <span style="color:#960050;background-color:#1e0010">https:</span><span style="color:#75715e">//www.sitename.org/wp-json/wp/v2/users
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>[{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Administrator&#34;</span>, <span style="color:#f92672">&#34;slug&#34;</span>:<span style="color:#e6db74">&#34;admin&#34;</span>}]<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#ae81ff">2</span>,<span style="color:#f92672">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Vincent Valentine&#34;</span>, <span style="color:#f92672">&#34;slug&#34;</span>:<span style="color:#e6db74">&#34;Vincent&#34;</span>}<span style="color:#960050;background-color:#1e0010">]</span>
</span></span></code></pre></div><blockquote>
<p>These slugs can then be used in an attempt to log in as the disclosed users with a brute-force, credential-stuffing, or password-spraying attack.</p>
</blockquote>
<p><strong>Error messaging</strong> helps API consumers troubleshoot their interactions with an API and allows API providers to understand issues with their application. However, it can also reveal sensitive information about <strong>resources</strong>, <strong>users</strong>, and the <strong>API‚Äôs underlying architecture</strong> (such as the version of the web server or database).</p>
<p>Often, you can gather the most information by interacting with an <strong>API endpoint</strong> and <strong>analyzing</strong> the <strong>response</strong>. API responses can reveal information within <strong>headers</strong>, <strong>parameters</strong>, and <strong>verbose errors</strong>. Other good sources of information are <strong>API documentation</strong> and resources gathered during reconnaissance.</p>
<hr>
<h1 id="broken-object-level-authorization">Broken Object Level Authorization</h1>
<p>BOLA vulnerabilities occur when an API provider allows an API consumer access to resources they are <strong>not authorized</strong> to access.</p>
<p>For instance, imagine that we are authorized to access only the user Cloud Strife. We would send an initial GET request to <a href="https://bestgame.com/api/v3/users?id=5501"><code>https://bestgame.com/api/v3/users?id=5501</code></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;5501&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;first_name&#34;</span>: <span style="color:#e6db74">&#34;Cloud&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;last_name&#34;</span>: <span style="color:#e6db74">&#34;Strife&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;link&#34;</span>: <span style="color:#e6db74">&#34;https://www.bestgame.com/user/strife.buster.97&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Cloud Strife&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;dob&#34;</span>: <span style="color:#e6db74">&#34;1997-01-31&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;strife.buster.97&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this situation, we might check for these problems by using another <strong>identification number</strong> that is close to Cloud‚Äôs ID of 5501. Say we are able to obtain information about another user.</p>
<p>In general, you can test for BOLAs by <strong>understanding how an API‚Äôs resources</strong> are structured and attempting to access resources you shouldn‚Äôt be able to access. By <strong>detecting patterns within API paths</strong> and <strong>parameters</strong>, you should be able to predict other potential resources.</p>
<p>BOLA can be a <strong>low-hanging</strong> API vulnerability that you can easily discover using pattern recognition and then prodding it with a few requests. Other times, it can be <strong>quite complicated</strong> to discover due to the <strong>complexities of object IDs</strong> and the requests used to obtain another user‚Äôs resources.</p>
<hr>
<h1 id="broken-user-authentication">Broken User Authentication</h1>
<p>Broken user authentication refers to any weakness within the API authentication process. These vulnerabilities typically occur when an API provider either doesn‚Äôt implement an <strong>authentication protection mechanism</strong> or implements a mechanism incorrectly.</p>
<p>As we know from the six constraints of REST APIs discussed in Chapter 2, <strong>RESTful APIs</strong> are supposed to be <strong>stateless</strong>. In order to be stateless, the provider shouldn‚Äôt need to remember the consumer from one request to another. For this constraint to work, APIs often require users to undergo a registration process in order to obtain a <strong>unique token</strong>. Users can then include the token within requests to demonstrate that they‚Äôre authorized to make such requests</p>
<p>To determine if the token generation process is weak, for example, we could collect a sampling of tokens and analyze them for similarities. If the token generation process doesn‚Äôt rely on a <em><strong>high level
of randomness</strong></em>, or entropy, there is a chance we‚Äôll be able to create our own token or hijack someone else‚Äôs.</p>
<p><em><strong>Token handling</strong></em> could be the storage of tokens, the method of transmitting tokens across a network, the presence of hardcoded tokens, and so on. We might be able to detect hardcoded tokens in <strong>JavaScript</strong> source files or capture them as we analyze a web application. Once we‚Äôve captured a token, we can use it to gain access to previously hidden endpoints or to bypass detection. If an API provider attributes an identity to a token, we would then take on the identity by hijacking the stolen token.</p>
<p>The other authentication processes that could have their own set of vulnerabilities include aspects of the registration system, such as the password reset and multifactor authentication features. For example, imagine a password reset feature requires you to provide an email address and a six-digit code to reset your password. Well, if the API allowed you to <strong>make as many requests as you wanted</strong>, you‚Äôd only have to make one million requests in order to guess the code and reset any user‚Äôs password. A four-digit code would require only 10,000 requests.</p>
<p>Due to the stateless nature of REST APIs, a publicly exposed API key is the equivalent of discovering a username and password. By using an exposed <strong>API key</strong>, <strong>you‚Äôll assume the role associated with that key</strong>.</p>
<hr>
<h1 id="excessive-data-exposure">Excessive Data Exposure</h1>
<p>Excessive data exposure is when an API endpoint responds with more information than is needed to fulfill a request.</p>
<blockquote>
<p>When this vulnerability is present, it can be the equivalent of asking someone for their <strong>name</strong> and having them respond with their <strong>name, date of birth, email address, phone number, and the identification of every other person they know</strong>.</p>
</blockquote>
<p>Suppose I requested my own account information with the following request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET</span> <span style="color:#960050;background-color:#1e0010">/api/v</span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">/account?name=Cloud+Strife</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">respone</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;5501&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;first_name&#34;</span>: <span style="color:#e6db74">&#34;Cloud&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;last_name&#34;</span>: <span style="color:#e6db74">&#34;Strife&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;privilege&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;representative&#34;</span>: [
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;Don Corneo&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;id&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;2203&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;email&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;dcorn@gmail.com&#34;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;privilege&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;super-admin&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;two_factor_auth&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>All you need to do to detect excessive data exposure is test your target <strong>API endpoints</strong> and review the information sent in response</p>
<hr>
<h1 id="lack-of-resources-and-rate-limiting">Lack of Resources and Rate Limiting</h1>
<p>Rate limiting plays an important role in the monetization and availability of APIs. Without limiting the <strong>number of requests</strong> consumers can make, an API provider‚Äôs infrastructure could be <strong>overwhelmed</strong> by the requests. Too many requests without enough resources will lead to the provider‚Äôs systems crashing and becoming unavailable‚Äîa denial of service (DoS) state <a href="https://rapidapi.com/">RapidAPI</a> , for example, allows for 500 requests per month for free but 1,000 requests per month for paying customers.</p>
<p>Once you are restricted from making additional requests, it‚Äôs time to attempt to see how rate limiting is enforced. Can you <strong>bypass it</strong> by adding or removing a parameter, using a different client, or altering your IP address?</p>
<hr>
<h1 id="broken-function-level-authorization">Broken Function Level Authorization</h1>
<p><strong>Broken function level authorization</strong> (BFLA) is a vulnerability where a user of one role or group is able to access the API functionality of another role or group.</p>
<blockquote>
<p><strong>BFLA</strong> is similar to <strong>BOLA</strong>, except instead of an authorization problem involving accessing resources, it is an authorization problem for performing actions.</p>
</blockquote>
<ul>
<li>When a <strong>BOLA</strong> vulnerability is present in the API, you might be able to access the information
of other accounts, such as payment histories, usernames, email addresses, and account numbers</li>
<li>If a <strong>BFLA</strong> vulnerability is present, you might be able to transfer money and actually update the account information.</li>
</ul>
<blockquote>
<p>Instead, the functionality could be <strong>based on HTTP request</strong> methods such as <code>GET</code>, <code>POST</code>, <code>PUT</code>, and <code>DELETE</code>. If a provider doesn‚Äôt restrict the HTTP methods a consumer can use, simply making an <code>unauthorized request</code> with a different method could indicate a BFLA vulnerability.</p>
</blockquote>
<p>The easiest way to discover BFLA is to find <strong>administrative API documentation</strong> and send requests as an unprivileged user that test admin functions and capabilities. If API documentation for privileged actions is not available, you will need to discover or <strong>reverse engineer</strong> the endpoints used to perform privileged actions before testing them.</p>
<hr>
<h1 id="mass-assignment">Mass Assignment</h1>
<p>Mass assignment occurs when an API consumer <strong>includes more parameters</strong> in their requests than the application intended and the application adds these parameters to code variables or internal objects. <em>‚Äúi think it‚Äôs looklike Param Pollution‚Äù</em></p>
<p>For example, an application might have account update functionality that the user should use only to <strong>update</strong> their username, password, and address. If the consumer can include other parameters in a request related to their account, such as the <strong>account privilege level</strong> or sensitive information like <strong>account balances</strong>, and the application accepts those parameters <strong>without checking</strong> them against a whitelist of permitted actions, the consumer could take advantage of this weakness to change these values.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// Imagine an API is called to create an account with parameters for 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;User&#34;</span> <span style="color:#960050;background-color:#1e0010">and</span> <span style="color:#e6db74">&#34;Password&#34;</span><span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;User&#34;</span>: <span style="color:#e6db74">&#34;scuttleph1sh&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;Password&#34;</span>: <span style="color:#e6db74">&#34;GreatPassword123&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//While reading the API documentation regarding the account creation 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//process, suppose you discover that there is an additional key, &#34;isAdmin&#34;, that 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//consumers can use to become administrators. You could use a tool like 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//Postman or Burp Suite to add the attribute to a request and set the value 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//to true:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;User&#34;</span>: <span style="color:#e6db74">&#34;scuttleph1sh&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;Password&#34;</span>: <span style="color:#e6db74">&#34;GreatPassword123&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;isAdmin&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You can discover mass assignment vulnerabilities by finding <strong>interesting parameters</strong> in API documentation and then adding those parameters to a request. Look for parameters involved in <strong>user account properties</strong>, <strong>critical functions</strong>, and <strong>administrative actions</strong>. Intercepting API requests and responses could also reveal parameters worthy of testing. Additionally, you can guess parameters or <strong>fuzz</strong> them in API requests.</p>
<hr>
<h1 id="security-misconfigurations">Security Misconfigurations</h1>
<p><strong>Security misconfigurations</strong> include all the mistakes developers could make within the supporting security configurations of an API. For example, if the API‚Äôs supporting security configuration reveals an <strong>unpatched vulnerability</strong>, there is a chance that an attacker could leverage a published exploit to easily <em>‚Äúpwn‚Äù</em> the API and its system.</p>
<blockquote>
<p><em>Security misconfigurations</em> are really a set of weaknesses that includes misconfigured headers, misconfigured transit encryption, the use of default accounts, the acceptance of unnecessary HTTP methods, a lack of input sanitization, and verbose error messaging.</p>
</blockquote>
<p>A lack of input sanitization can allow attackers to upload malicious payloads to the server.</p>
<p>For example, if an upload endpoint was used to pass uploaded files to a web directory, it could allow the <strong>upload of a script</strong>. Navigating to the URL where the file is located could launch the script,
resulting in <strong>direct shell access</strong> to the web server.</p>
<p>API providers use <em>headers</em> to provide the consumer with instructions for <strong>handling the response</strong> and <strong>security requirements</strong>. Misconfigured headers can result in sensitive information disclosure, downgrade attacks, and cross-site scripting attacks.</p>
<p>For example, take the following response:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">HTTP/</span> <span style="color:#ae81ff">200</span> <span style="color:#960050;background-color:#1e0010">OK</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">--snip--</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">X-Powered-By:</span> <span style="color:#960050;background-color:#1e0010">VulnService</span> <span style="color:#ae81ff">1.11</span> <span style="color:#75715e">// reveal backend tech =&gt; search exploits
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">X-XSS-Protection:</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">// could be changed to 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">X-Response-Time:</span> <span style="color:#ae81ff">566.43</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//If the X-Response-Time header has a consistent response time for nonexistent records, for example, but increases 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// its response time for certain other records, this could be an indication that those records exist.
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">HTTP/UserA</span> <span style="color:#ae81ff">404</span> <span style="color:#960050;background-color:#1e0010">Not</span> <span style="color:#960050;background-color:#1e0010">Found</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">--snip--</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">X-Response-Time:</span> <span style="color:#ae81ff">25.5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">HTTP/UserB</span> <span style="color:#ae81ff">404</span> <span style="color:#960050;background-color:#1e0010">Not</span> <span style="color:#960050;background-color:#1e0010">Found</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">--snip--</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">X-Response-Time:</span> <span style="color:#ae81ff">25.5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">HTTP/UserC</span> <span style="color:#ae81ff">404</span> <span style="color:#960050;background-color:#1e0010">Not</span> <span style="color:#960050;background-color:#1e0010">Found</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">--snip--</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">X-Response-Time:</span> <span style="color:#ae81ff">510.00</span>
</span></span></code></pre></div><p>In this case, UserC has a response time value that is 20 times the response time of the other resources. With this small sample size, it is hard to definitively conclude that UserC exists.</p>
<p>Say, for instance, you know that a bogus account like <code>/user/account/thisdefinitelydoesnotexist876</code> has an average X-Response-Time of <code>25.5</code> ms. You also know that your existing account /user/account/1021 receives an X-Response-Time of <code>510.00</code>. If you then sent requests brute-forcing all account numbers from <code>1000</code> to <code>2000</code>, you could review the results and see which account numbers resulted in drastically increased response times.</p>
<p>Any API providing sensitive information to consumers should use <strong>Transport Layer Security</strong> (TLS) to encrypt the data. Even if the API is only provided internally, privately, or at a partner level, using TLS, the protocol that encrypts HTTPS traffic, is one of the most basic ways to ensure that API requests and responses are protected when being passed across a network. Misconfigured or missing transit encryption can cause API users to pass <strong>sensitive API information in cleartext</strong> across networks.
Then The Attacker Could Exploit it using The MITM Attack.</p>
<p>When a service uses a <strong>default account and credentials</strong> and the defaults are known, an attacker can use those credentials to assume the role of that account. This could allow them to gain access to sensitive information or administrative functionality, potentially leading to a compromise of the
supporting systems.</p>
<p>Lastly, if an API provider allows <strong>unnecessary HTTP methods</strong>, there is an increased risk that the application won‚Äôt handle these methods properly or will result in <strong>sensitive information disclosure</strong>.</p>
<p>You can detect several of these security misconfigurations with web application vulnerability scanners such as <strong>Nessus</strong>, <strong>Qualys</strong>, <strong>OWASP ZAP</strong>, and <strong>Nikto</strong>. These scanners will automatically check the web server <strong>version information</strong>, <strong>headers</strong>, <strong>cookies</strong>, <strong>transit</strong> encryption configuration, and parameters to see if expected security measures are missing. You can also check for these security misconfigurations manually, if you know what you are looking for, by inspecting the <strong>headers</strong>, <strong>SSL certificate</strong>, <strong>cookies</strong>, and <strong>parameters</strong>.</p>
<hr>
<h1 id="injections">Injections</h1>
<p><strong>Injection flaws</strong> exist when a request is passed to the API‚Äôs supporting infrastructure and the API provider doesn‚Äôt filter the input to remove unwanted characters (a process known as <strong>input sanitization</strong>). Verbose <strong>error messaging</strong>, HTTP response codes, and unexpected API behavior can all be clues that you may have discovered an injection flaw.</p>
<p>The API may pass that payload directly to the backend SQL database, where the OR 1=0 statement would fail (because 1 does no equal 0), causing some SQL error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">POST</span> <span style="color:#960050;background-color:#1e0010">/api/v</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">/register</span> <span style="color:#960050;background-color:#1e0010">HTTP</span> <span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">Host:</span> <span style="color:#960050;background-color:#1e0010">example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">--snip--</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;Fname&#34;</span>: <span style="color:#e6db74">&#34;hAPI&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;Lname&#34;</span>: <span style="color:#e6db74">&#34;Hacker&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;Address&#34;</span>: <span style="color:#e6db74">&#34;&#39; OR 1=0--&#34;</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Injection vulnerabilities are often complemented by other vulnerabilities such as poor <strong>input sanitization</strong>. In the following example, you can see a code injection attack that uses an API GET request to take advantage of a <strong>weak query parameter</strong>. In this case, the weak query parameter passes any data in the query portion of the request directly to the underlying system, without sanitizing it first: <code>GET http://10.10.78.181:5000/api/v1/resources/books?show=/etc/passwd</code>
The following response body shows that the API endpoint has been manipulated into displaying the host‚Äôs /etc/passwd file, revealing users on the system:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">root:x:</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">:root:/root:/bin/bash</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">daemon:x:</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">:daemon:/usr/sbin:/usr/sbin/nologin</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">bin:x:</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">:bin:/dev:/usr/sbin/nologin</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">sync:x:</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">65534</span><span style="color:#960050;background-color:#1e0010">:sync:/bin:/bin/sync</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">games:x:</span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">60</span><span style="color:#960050;background-color:#1e0010">:games:/usr/games:/usr/sbin/nologin</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">man:x:</span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">12</span><span style="color:#960050;background-color:#1e0010">:man:/var/cache/man:/usr/sbin/nologin</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">lp:x:</span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">:lp:/var/spool/lpd:/usr/sbin/nologin</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">mail:x:</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">:mail:/var/mail:/usr/sbin/nologin</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">news:x:</span><span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">:news:/var/spool/news:/usr/sbin/nologin</span>
</span></span></code></pre></div><p>Finding injection flaws requires diligently testing API endpoints, paying attention to how the <strong>API responds</strong>, and then crafting requests that attempt to manipulate the backend systems. Like directory traversal attacks, injection attacks have been around for decades, so there are many standard security controls to protect API providers from them.</p>
<hr>
<h1 id="improper-assets-management">Improper Assets Management</h1>
<p><strong>Improper assets management</strong> takes place when an organization exposes APIs
that are either retired or still in development. APIs that are still being developed are typically not as secure as their production API counterparts.</p>
<p>Improper assets management can lead to other vulnerabilities, such as excessive data exposure, information disclosure, mass assignment, improper rate limiting, and API injection.</p>
<p>You can discover improper assets management by paying close attention to <strong>outdated</strong> API <strong>documentation</strong>, <strong>changelogs</strong>, and <strong>version</strong> history on repositories.</p>
<p>Organizations often include versioning information in their endpoint names to distinguish between older and newer versions, such as <code>/v1/, /v2/, /v3/</code>, and so on. APIs still in development often use paths such as <code>/alpha/, /beta/, /test/, /uat/, and /demo/</code>.  If you know that an API is now using <a href="http://apiv3.org/admin">apiv3.org/admin</a> but part of the API documentation refers to <a href="http://apiv1.org/admin">apiv1.org/admin</a>, you could try testing different endpoints to see if apiv1 or apiv2 is still active. Additionally, the organization‚Äôs changelog
may disclose the reasons why v1 was updated or retired. If you have access to v1, you can test for those weaknesses</p>
<p>Outside of using documentation, you can discover improper assets management vulnerabilities through the use of <strong>guessing</strong>, <strong>fuzzing</strong>, or <strong>brute-force</strong> requests. Watch for patterns in the API documentation or path-naming scheme, and then make requests based on your assumptions.</p>
<hr>
<h1 id="business-logic-vulnerabilities">Business Logic Vulnerabilities</h1>
<p>Business logic vulnerabilities (also known as business logic flaws, or BLFs) are intended features of an application that attackers can use maliciously.</p>
<p>For example, if an API has an upload feature that doesn‚Äôt validate <strong>encoded payloads</strong>, a user could upload any file as long as it was encoded. This would allow end users to upload and execute arbitrary code, including malicious payloads. In those cases, the organization essentially depends
on <strong>trust</strong> as a security control by expecting the consumer to act benevolently. Unfortunately, even <strong>good-natured API consumers</strong> make mistakes that could lead to a compromise of the application.</p>
<p>You can search API documentation for <strong>telltale signs</strong> of business logic vulnerabilities. Statements like the following should illuminate the lightbulb above your head:</p>
<blockquote>
<p>‚ÄúOnly use feature X to perform function Y.‚Äù
‚ÄúDo not do X with endpoint Y.‚Äù
‚ÄúOnly admins should perform request X.‚Äù</p>
</blockquote>
<p>When you attack their API, make sure to disobey such requests to test for the presence of security controls.</p>
<p>As an example, consider a web application authentication portal that a user would normally employ to authenticate to their account. Say the web application issued the following API request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">POST</span> <span style="color:#960050;background-color:#1e0010">/api/v</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">/login</span> <span style="color:#960050;background-color:#1e0010">HTTP</span> <span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">Host:</span> <span style="color:#960050;background-color:#1e0010">example.com</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">--snip--</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">UserId=hapihacker&amp;password=arealpassword!&amp;MFA=</span><span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>There is a chance that we could bypass multifactor authentication by simply altering the parameter <code>MFA</code> to <code>false</code>.</p>
<p>Testing for business logic flaws can be challenging because each business is <strong>unique</strong>. Automated scanners will have a difficult time detecting these issues, as the flaws are part of the API‚Äôs intended use. You must understand <strong>how the business and API operate</strong> and then consider how you could use these features to your advantage. <strong>Study the application‚Äôs business logic with an adversarial mindset</strong> , and try breaking any assumptions that have
been made</p>
<hr>
<h1 id="summary">Summary</h1>
<p>It is important to become familiar with these vulnerabilities so that you can easily recognize them, take advantage of them during an engagement, and report them back to the organization to prevent the criminals from dragging your client into the headlines. Now that you are familiar with web applications, APIs, and their weaknesses, it is time to prepare your hacking machine and get your hands busy on the keyboard.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
